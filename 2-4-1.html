<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>定价模型应用模拟 - 投资时机选择与方法</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #34495e;
            --success: #2ecc71;
            --warning: #f39c12;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 30px 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .game-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .panel-title {
            font-size: 1.4rem;
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light);
        }
        
        .model-selection {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .model-btn {
            flex: 1;
            padding: 12px;
            background: var(--light);
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .model-btn.active {
            background: var(--secondary);
            color: white;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: var(--primary);
            transform: translateY(-2px);
        }
        
        .btn-accent {
            background: var(--accent);
        }
        
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            background: var(--light);
        }
        
        .assets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .asset-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--secondary);
            transition: transform 0.3s;
        }
        
        .asset-card:hover {
            transform: translateY(-5px);
        }
        
        .asset-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .asset-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .asset-change {
            font-size: 0.9rem;
        }
        
        .asset-change.positive {
            color: var(--success);
        }
        
        .asset-change.negative {
            color: var(--accent);
        }
        
        .portfolio {
            background: var(--light);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .portfolio-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #ddd;
        }
        
        .chart-container {
            height: 300px;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            padding: 15px;
        }
        
        .instructions {
            background: var(--light);
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
        }
        
        .instructions h3 {
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        .instructions ol {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 10px;
        }
        
        .investment-history {
            margin-top: 20px;
        }
        
        .history-item {
            background: var(--light);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }
        
        .history-item.buy {
            border-left: 4px solid var(--success);
        }
        
        .history-item.sell {
            border-left: 4px solid var(--accent);
        }
        
        .period-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }
        
        .period-btn {
            padding: 8px 15px;
            background: var(--light);
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .period-btn.active {
            background: var(--secondary);
            color: white;
        }
        
        @media (max-width: 768px) {
            .game-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>定价模型应用模拟</h1>
            <p class="subtitle">使用CAPM或APT模型评估资产价值并选择投资时机</p>
        </header>
        
        <div class="game-container">
            <div class="panel">
                <h2 class="panel-title">模型选择与参数设置</h2>
                
                <div class="model-selection">
                    <button class="model-btn active" id="capm-btn">CAPM模型</button>
                    <button class="model-btn" id="apt-btn">APT模型</button>
                </div>
                
                <div id="capm-params" class="model-params">
                    <div class="form-group">
                        <label for="risk-free-rate">无风险利率 (%)</label>
                        <input type="number" id="risk-free-rate" value="3" step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label for="market-return">市场预期收益率 (%)</label>
                        <input type="number" id="market-return" value="8" step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label for="beta-coefficient">资产贝塔系数</label>
                        <input type="number" id="beta-coefficient" value="1.2" step="0.1">
                    </div>
                </div>
                
                <div id="apt-params" class="model-params" style="display: none;">
                    <div class="form-group">
                        <label for="risk-free-rate-apt">无风险利率 (%)</label>
                        <input type="number" id="risk-free-rate-apt" value="3" step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label for="factor1">因子1: GDP增长率 (%)</label>
                        <input type="number" id="factor1" value="2.5" step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label for="sensitivity1">对因子1的敏感度</label>
                        <input type="number" id="sensitivity1" value="1.5" step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label for="factor2">因子2: 通货膨胀率 (%)</label>
                        <input type="number" id="factor2" value="2.0" step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label for="sensitivity2">对因子2的敏感度</label>
                        <input type="number" id="sensitivity2" value="0.8" step="0.1">
                    </div>
                </div>
                
                <button class="btn" id="calculate-btn">计算预期收益率</button>
                
                <div class="result" id="calculation-result">
                    <p>预期收益率: <span id="expected-return">--</span>%</p>
                    <p>投资建议: <span id="investment-advice">--</span></p>
                </div>
                
                <div class="investment-history">
                    <h3>投资历史</h3>
                    <div id="history-container"></div>
                </div>
            </div>
            
            <div class="panel">
                <h2 class="panel-title">市场与投资组合</h2>
                
                <div class="market-status">
                    <h3>当前市场状况</h3>
                    <div class="assets-grid" id="assets-container">
                        <!-- 资产卡片将通过JS动态生成 -->
                    </div>
                </div>
                
                <div class="portfolio">
                    <h3>您的投资组合</h3>
                    <div id="portfolio-container">
                        <!-- 投资组合内容将通过JS动态生成 -->
                    </div>
                </div>
                
                <div class="investment-action">
                    <h3>投资操作</h3>
                    <div class="form-group">
                        <label for="asset-select">选择资产</label>
                        <select id="asset-select">
                            <!-- 选项将通过JS动态生成 -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="investment-amount">投资金额 (¥)</label>
                        <input type="number" id="investment-amount" value="1000">
                    </div>
                    
                    <button class="btn btn-accent" id="invest-btn">执行投资</button>
                </div>
            </div>
        </div>
        
        <div class="panel">
            <h2 class="panel-title">投资表现分析</h2>
            <div class="period-controls">
                <button class="period-btn active" data-period="7">7天</button>
                <button class="period-btn" data-period="30">30天</button>
                <button class="period-btn" data-period="90">90天</button>
                <button class="period-btn" data-period="180">180天</button>
                <button class="period-btn" data-period="365">1年</button>
            </div>
            <div class="chart-container">
                <canvas id="performance-chart"></canvas>
            </div>
        </div>
        
        <div class="instructions">
            <h3>游戏说明</h3>
            <ol>
                <li>选择定价模型：CAPM（资本资产定价模型）或APT（套利定价模型）</li>
                <li>根据所选模型设置相应参数</li>
                <li>计算资产的预期收益率</li>
                <li>根据计算结果和市场状况，选择投资资产和金额</li>
                <li>观察投资表现，调整投资策略</li>
                <li>目标：在10个模拟周期内获得最高投资回报</li>
            </ol>
            <p><strong>学习目标：</strong>通过实践掌握CAPM和APT模型的应用，理解如何根据定价模型评估资产价值并选择投资时机。</p>
        </div>
    </div>

    <script>
        // 模拟数据
        const assets = [
            { id: 'stockA', name: '股票A', price: 85.60, change: 1.2, beta: 1.2 },
            { id: 'stockB', name: '股票B', price: 42.30, change: -0.5, beta: 0.8 },
            { id: 'bondC', name: '债券C', price: 102.50, change: 0.3, beta: 0.2 },
            { id: 'etfD', name: 'ETF D', price: 156.80, change: 2.1, beta: 1.0 }
        ];
        
        let portfolio = {
            cash: 10000,
            holdings: {
                stockA: { quantity: 5, avgPrice: 85.60 },
                etfD: { quantity: 3, avgPrice: 156.80 }
            }
        };
        
        let investmentHistory = [];
        let performanceData = [];
        let currentPeriod = 7;
        
        // 初始化函数
        function init() {
            renderAssets();
            renderPortfolio();
            renderAssetSelect();
            initChart();
            updateChart();
            
            // 模型选择
            document.getElementById('capm-btn').addEventListener('click', function() {
                document.getElementById('capm-btn').classList.add('active');
                document.getElementById('apt-btn').classList.remove('active');
                document.getElementById('capm-params').style.display = 'block';
                document.getElementById('apt-params').style.display = 'none';
            });
            
            document.getElementById('apt-btn').addEventListener('click', function() {
                document.getElementById('apt-btn').classList.add('active');
                document.getElementById('capm-btn').classList.remove('active');
                document.getElementById('apt-params').style.display = 'block';
                document.getElementById('capm-params').style.display = 'none';
            });
            
            // 计算预期收益率
            document.getElementById('calculate-btn').addEventListener('click', calculateExpectedReturn);
            
            // 执行投资
            document.getElementById('invest-btn').addEventListener('click', executeInvestment);
            
            // 周期控制
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentPeriod = parseInt(this.dataset.period);
                    updateChart();
                });
            });
            
            // 初始化性能数据
            generatePerformanceData();
        }
        
        // 渲染资产列表
        function renderAssets() {
            const container = document.getElementById('assets-container');
            container.innerHTML = '';
            
            assets.forEach(asset => {
                const card = document.createElement('div');
                card.className = 'asset-card';
                card.innerHTML = `
                    <div class="asset-name">${asset.name}</div>
                    <div class="asset-value">¥${asset.price.toFixed(2)}</div>
                    <div class="asset-change ${asset.change >= 0 ? 'positive' : 'negative'}">
                        ${asset.change >= 0 ? '+' : ''}${asset.change}%
                    </div>
                `;
                container.appendChild(card);
            });
        }
        
        // 渲染投资组合
        function renderPortfolio() {
            const container = document.getElementById('portfolio-container');
            container.innerHTML = '';
            
            // 计算总资产
            let totalValue = portfolio.cash;
            
            // 现金
            const cashItem = document.createElement('div');
            cashItem.className = 'portfolio-item';
            cashItem.innerHTML = `<span>现金</span><span>¥${portfolio.cash.toFixed(2)}</span>`;
            container.appendChild(cashItem);
            
            // 持有的资产
            for (const [assetId, holding] of Object.entries(portfolio.holdings)) {
                const asset = assets.find(a => a.id === assetId);
                if (asset) {
                    const value = holding.quantity * asset.price;
                    totalValue += value;
                    
                    const item = document.createElement('div');
                    item.className = 'portfolio-item';
                    item.innerHTML = `<span>${asset.name}</span><span>${holding.quantity}股 (¥${value.toFixed(2)})</span>`;
                    container.appendChild(item);
                }
            }
            
            // 总资产
            const totalItem = document.createElement('div');
            totalItem.className = 'portfolio-item';
            totalItem.style.fontWeight = '600';
            totalItem.innerHTML = `<span>总资产</span><span>¥${totalValue.toFixed(2)}</span>`;
            container.appendChild(totalItem);
            
            // 更新性能数据
            performanceData.push({
                date: new Date(),
                value: totalValue
            });
            
            // 限制性能数据长度
            if (performanceData.length > 365) {
                performanceData = performanceData.slice(-365);
            }
        }
        
        // 渲染资产选择下拉菜单
        function renderAssetSelect() {
            const select = document.getElementById('asset-select');
            select.innerHTML = '';
            
            assets.forEach(asset => {
                const option = document.createElement('option');
                option.value = asset.id;
                option.textContent = asset.name;
                select.appendChild(option);
            });
        }
        
        // 计算预期收益率
        function calculateExpectedReturn() {
            let expectedReturn, advice;
            
            if (document.getElementById('capm-btn').classList.contains('active')) {
                // CAPM计算: E(R) = Rf + β(Rm - Rf)
                const riskFreeRate = parseFloat(document.getElementById('risk-free-rate').value) / 100;
                const marketReturn = parseFloat(document.getElementById('market-return').value) / 100;
                const beta = parseFloat(document.getElementById('beta-coefficient').value);
                
                expectedReturn = (riskFreeRate + beta * (marketReturn - riskFreeRate)) * 100;
            } else {
                // APT计算: E(R) = Rf + β1F1 + β2F2 + ...
                const riskFreeRate = parseFloat(document.getElementById('risk-free-rate-apt').value) / 100;
                const factor1 = parseFloat(document.getElementById('factor1').value) / 100;
                const sensitivity1 = parseFloat(document.getElementById('sensitivity1').value);
                const factor2 = parseFloat(document.getElementById('factor2').value) / 100;
                const sensitivity2 = parseFloat(document.getElementById('sensitivity2').value);
                
                expectedReturn = (riskFreeRate + sensitivity1 * factor1 + sensitivity2 * factor2) * 100;
            }
            
            // 生成投资建议
            if (expectedReturn > 10) {
                advice = "强烈建议投资 - 预期收益率高";
            } else if (expectedReturn > 5) {
                advice = "建议投资 - 预期收益率适中";
            } else {
                advice = "谨慎投资 - 预期收益率较低";
            }
            
            document.getElementById('expected-return').textContent = expectedReturn.toFixed(2);
            document.getElementById('investment-advice').textContent = advice;
        }
        
        // 执行投资
        function executeInvestment() {
            const selectedAssetId = document.getElementById('asset-select').value;
            const amount = parseFloat(document.getElementById('investment-amount').value);
            
            if (amount <= 0) {
                alert("请输入有效的投资金额");
                return;
            }
            
            if (amount > portfolio.cash) {
                alert("投资金额超过可用现金");
                return;
            }
            
            const asset = assets.find(a => a.id === selectedAssetId);
            if (!asset) {
                alert("选择的资产不存在");
                return;
            }
            
            const quantity = Math.floor(amount / asset.price);
            const actualAmount = quantity * asset.price;
            
            // 更新投资组合
            portfolio.cash -= actualAmount;
            
            if (portfolio.holdings[selectedAssetId]) {
                // 已有持仓，更新平均价格和数量
                const currentHolding = portfolio.holdings[selectedAssetId];
                const totalCost = currentHolding.quantity * currentHolding.avgPrice + actualAmount;
                const totalQuantity = currentHolding.quantity + quantity;
                currentHolding.avgPrice = totalCost / totalQuantity;
                currentHolding.quantity = totalQuantity;
            } else {
                // 新持仓
                portfolio.holdings[selectedAssetId] = {
                    quantity: quantity,
                    avgPrice: asset.price
                };
            }
            
            // 记录投资历史
            const historyItem = {
                type: 'buy',
                asset: asset.name,
                quantity: quantity,
                price: asset.price,
                amount: actualAmount,
                date: new Date()
            };
            
            investmentHistory.unshift(historyItem);
            renderInvestmentHistory();
            
            // 更新UI
            renderPortfolio();
            updateChart();
            
            alert(`成功投资 ¥${actualAmount.toFixed(2)} 到 ${asset.name}，购买 ${quantity} 股`);
        }
        
        // 渲染投资历史
        function renderInvestmentHistory() {
            const container = document.getElementById('history-container');
            container.innerHTML = '';
            
            // 只显示最近的10条记录
            const recentHistory = investmentHistory.slice(0, 10);
            
            if (recentHistory.length === 0) {
                container.innerHTML = '<p>暂无投资记录</p>';
                return;
            }
            
            recentHistory.forEach(item => {
                const historyElement = document.createElement('div');
                historyElement.className = `history-item ${item.type}`;
                
                const dateStr = item.date.toLocaleDateString();
                const timeStr = item.date.toLocaleTimeString();
                
                historyElement.innerHTML = `
                    <div><strong>${item.type === 'buy' ? '买入' : '卖出'} ${item.asset}</strong></div>
                    <div>数量: ${item.quantity}股 | 价格: ¥${item.price.toFixed(2)} | 金额: ¥${item.amount.toFixed(2)}</div>
                    <div style="font-size: 0.8rem; color: #666;">${dateStr} ${timeStr}</div>
                `;
                
                container.appendChild(historyElement);
            });
        }
        
        // 图表初始化
        let performanceChart;
        
        function initChart() {
            const ctx = document.getElementById('performance-chart').getContext('2d');
            
            performanceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: '投资组合价值',
                        data: [],
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '¥' + value.toLocaleString();
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return '投资组合价值: ¥' + context.parsed.y.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // 生成模拟性能数据
        function generatePerformanceData() {
            const baseDate = new Date();
            baseDate.setDate(baseDate.getDate() - 365);
            
            // 初始价值
            let value = 10000;
            
            for (let i = 0; i < 365; i++) {
                const date = new Date(baseDate);
                date.setDate(date.getDate() + i);
                
                // 模拟每日价值波动
                const dailyChange = (Math.random() - 0.5) * 0.02; // -1% 到 +1%
                value *= (1 + dailyChange);
                
                performanceData.push({
                    date: date,
                    value: value
                });
            }
            
            // 确保最后一天的价值是当前投资组合价值
            const currentValue = calculatePortfolioValue();
            performanceData[performanceData.length - 1].value = currentValue;
        }
        
        // 计算投资组合当前价值
        function calculatePortfolioValue() {
            let totalValue = portfolio.cash;
            
            for (const [assetId, holding] of Object.entries(portfolio.holdings)) {
                const asset = assets.find(a => a.id === assetId);
                if (asset) {
                    totalValue += holding.quantity * asset.price;
                }
            }
            
            return totalValue;
        }
        
        // 更新图表
        function updateChart() {
            if (!performanceChart) return;
            
            // 根据选择的周期过滤数据
            const filteredData = performanceData.slice(-currentPeriod);
            
            // 更新图表数据
            performanceChart.data.labels = filteredData.map(item => {
                const date = new Date(item.date);
                return date.toLocaleDateString();
            });
            
            performanceChart.data.datasets[0].data = filteredData.map(item => item.value);
            
            performanceChart.update();
        }
        
        // 初始化应用
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>