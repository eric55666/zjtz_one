<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>公司财务侦探 - 财务报表分析与估值模拟</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #34495e;
            --success: #2ecc71;
            --warning: #f39c12;
            --income: #2ecc71;
            --balance: #3498db;
            --cashflow: #9b59b6;
            --manufacturing: #3498db;
            --technology: #9b59b6;
            --healthcare: #2ecc71;
            --consumer: #e67e22;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 30px 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 10px 10px 0 0;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: var(--light);
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: var(--secondary);
            color: white;
        }
        
        .tab-content {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }
        
        .panel-title {
            font-size: 1.4rem;
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light);
        }
        
        .company-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .company-card {
            background: var(--light);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
        }
        
        .company-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .company-card.active {
            border-color: var(--secondary);
            background: rgba(52, 152, 219, 0.1);
        }
        
        .company-card.manufacturing {
            border-left: 4px solid var(--manufacturing);
        }
        
        .company-card.technology {
            border-left: 4px solid var(--technology);
        }
        
        .company-card.healthcare {
            border-left: 4px solid var(--healthcare);
        }
        
        .company-card.consumer {
            border-left: 4px solid var(--consumer);
        }
        
        .company-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .company-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .company-description {
            font-size: 0.9rem;
            color: #666;
        }
        
        .financial-statements {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .statement-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s;
        }
        
        .statement-card.income {
            border-top: 4px solid var(--income);
        }
        
        .statement-card.balance {
            border-top: 4px solid var(--balance);
        }
        
        .statement-card.cashflow {
            border-top: 4px solid var(--cashflow);
        }
        
        .statement-card:hover {
            transform: translateY(-5px);
        }
        
        .statement-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .statement-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .statement-item:last-child {
            border-bottom: none;
            font-weight: 600;
            color: var(--primary);
        }
        
        .valuation-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .valuation-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s;
        }
        
        .valuation-card:hover {
            transform: translateY(-5px);
        }
        
        .valuation-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .valuation-formula {
            background: var(--light);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-family: monospace;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: var(--primary);
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-accent {
            background: var(--accent);
        }
        
        .analysis-result {
            background: var(--light);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .result-score {
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 15px;
        }
        
        .result-description {
            margin-bottom: 15px;
        }
        
        .red-flags {
            background: rgba(231, 76, 60, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid var(--accent);
        }
        
        .chart-container {
            height: 400px;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            padding: 15px;
        }
        
        .risk-indicators {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .risk-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .risk-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .risk-description {
            font-size: 0.9rem;
            color: #666;
        }
        
        .instructions {
            background: var(--light);
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
        }
        
        .instructions h3 {
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        .instructions ol {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 10px;
        }
        
        .valuation-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .summary-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .summary-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .summary-value {
            font-size: 1.2rem;
            font-weight: 700;
        }
        
        @media (max-width: 768px) {
            .company-selection {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .financial-statements {
                grid-template-columns: 1fr;
            }
            
            .valuation-methods {
                grid-template-columns: 1fr;
            }
            
            .risk-indicators {
                grid-template-columns: 1fr;
            }
            
            .valuation-summary {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>公司财务侦探</h1>
            <p class="subtitle">分析上市公司财务报表 | 使用估值方法评估公司价值 | 识别财务风险</p>
        </header>
        
        <div class="tabs">
            <button class="tab active" data-tab="financial-analysis">财务报表分析</button>
            <button class="tab" data-tab="valuation">公司估值</button>
            <button class="tab" data-tab="risk-assessment">风险识别</button>
            <button class="tab" data-tab="case-study">瑞幸咖啡案例</button>
        </div>
        
        <div id="financial-analysis" class="tab-content active">
            <div class="panel">
                <h2 class="panel-title">选择分析公司</h2>
                <p>选择一家公司，分析其财务报表并计算关键财务比率。</p>
                
                <div class="company-selection">
                    <div class="company-card manufacturing active" data-company="luckin">
                        <div class="company-icon">☕</div>
                        <div class="company-name">瑞幸咖啡</div>
                        <div class="company-description">快速扩张的咖啡连锁品牌，曾因财务造假闻名</div>
                    </div>
                    
                    <div class="company-card technology" data-company="apple">
                        <div class="company-icon">📱</div>
                        <div class="company-name">苹果公司</div>
                        <div class="company-description">全球领先的科技公司，产品包括iPhone、iPad等</div>
                    </div>
                    
                    <div class="company-card healthcare" data-company="tesla">
                        <div class="company-icon">🚗</div>
                        <div class="company-name">特斯拉</div>
                        <div class="company-description">电动汽车和清洁能源公司，颠覆传统汽车行业</div>
                    </div>
                    
                    <div class="company-card consumer" data-company="coca-cola">
                        <div class="company-icon">🥤</div>
                        <div class="company-name">可口可乐</div>
                        <div class="company-description">全球知名饮料公司，拥有强大的品牌价值</div>
                    </div>
                </div>
                
                <div class="panel">
                    <h2 class="panel-title" id="selected-company-name">瑞幸咖啡 - 财务报表分析</h2>
                    <p>分析公司的三大财务报表，识别关键财务指标。</p>
                    
                    <div class="financial-statements">
                        <div class="statement-card income">
                            <div class="statement-title">利润表 (2022年)</div>
                            <div id="income-statement">
                                <!-- 利润表数据将通过JS动态生成 -->
                            </div>
                        </div>
                        
                        <div class="statement-card balance">
                            <div class="statement-title">资产负债表 (2022年末)</div>
                            <div id="balance-sheet">
                                <!-- 资产负债表数据将通过JS动态生成 -->
                            </div>
                        </div>
                        
                        <div class="statement-card cashflow">
                            <div class="statement-title">现金流量表 (2022年)</div>
                            <div id="cashflow-statement">
                                <!-- 现金流量表数据将通过JS动态生成 -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="panel">
                        <h3>关键财务比率分析</h3>
                        <div class="financial-statements">
                            <div class="statement-card">
                                <div class="statement-title">盈利能力比率</div>
                                <div id="profitability-ratios">
                                    <!-- 盈利能力比率数据将通过JS动态生成 -->
                                </div>
                            </div>
                            
                            <div class="statement-card">
                                <div class="statement-title">偿债能力比率</div>
                                <div id="solvency-ratios">
                                    <!-- 偿债能力比率数据将通过JS动态生成 -->
                                </div>
                            </div>
                            
                            <div class="statement-card">
                                <div class="statement-title">营运能力比率</div>
                                <div id="efficiency-ratios">
                                    <!-- 营运能力比率数据将通过JS动态生成 -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn" id="analyze-financials" style="margin-top: 20px;">分析财务健康状况</button>
                    
                    <div class="analysis-result" id="financial-analysis-result" style="display: none;">
                        <div class="result-score" id="financial-health-score">财务健康评分: --/100</div>
                        <div class="result-description" id="financial-health-description"></div>
                        
                        <div class="red-flags">
                            <h3>潜在风险信号</h3>
                            <div id="risk-signals"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="valuation" class="tab-content">
            <div class="panel">
                <h2 class="panel-title">公司估值方法</h2>
                <p>使用不同的估值方法评估公司价值，比较结果。</p>
                
                <div class="valuation-methods">
                    <div class="valuation-card">
                        <div class="valuation-title">股利贴现模型 (DDM)</div>
                        <div class="valuation-formula">P = D / (r - g)</div>
                        <div class="form-group">
                            <label for="dividend">预期年度股利 (D)</label>
                            <input type="number" id="dividend" value="0.5" step="0.1">
                        </div>
                        <div class="form-group">
                            <label for="discount-rate">必要收益率 (r)</label>
                            <input type="number" id="discount-rate" value="10" step="0.1">
                        </div>
                        <div class="form-group">
                            <label for="growth-rate">股利增长率 (g)</label>
                            <input type="number" id="growth-rate" value="3" step="0.1">
                        </div>
                        <button class="btn" id="calculate-ddm">计算价值</button>
                        <div class="result-description" id="ddm-result" style="margin-top: 15px;"></div>
                    </div>
                    
                    <div class="valuation-card">
                        <div class="valuation-title">市盈率法 (P/E)</div>
                        <div class="valuation-formula">P = EPS × P/E Ratio</div>
                        <div class="form-group">
                            <label for="eps">每股收益 (EPS)</label>
                            <input type="number" id="eps" value="1.2" step="0.1">
                        </div>
                        <div class="form-group">
                            <label for="pe-ratio">行业平均市盈率</label>
                            <input type="number" id="pe-ratio" value="25" step="0.1">
                        </div>
                        <button class="btn" id="calculate-pe">计算价值</button>
                        <div class="result-description" id="pe-result" style="margin-top: 15px;"></div>
                    </div>
                    
                    <div class="valuation-card">
                        <div class="valuation-title">自由现金流折现法 (DCF)</div>
                        <div class="valuation-formula">P = ∑ [FCF / (1+r)^t]</div>
                        <div class="form-group">
                            <label for="fcf">自由现金流 (FCF)</label>
                            <input type="number" id="fcf" value="2.5" step="0.1">
                        </div>
                        <div class="form-group">
                            <label for="dcf-growth">现金流增长率</label>
                            <input type="number" id="dcf-growth" value="5" step="0.1">
                        </div>
                        <div class="form-group">
                            <label for="dcf-discount">折现率</label>
                            <input type="number" id="dcf-discount" value="9" step="0.1">
                        </div>
                        <button class="btn" id="calculate-dcf">计算价值</button>
                        <div class="result-description" id="dcf-result" style="margin-top: 15px;"></div>
                    </div>
                </div>
                
                <div class="valuation-summary" id="valuation-summary">
                    <!-- 估值汇总将通过JS动态生成 -->
                </div>
                
                <div class="chart-container">
                    <canvas id="valuation-chart"></canvas>
                </div>
            </div>
        </div>
        
        <div id="risk-assessment" class="tab-content">
            <div class="panel">
                <h2 class="panel-title">财务风险识别</h2>
                <p>识别和分析公司财务报表中的潜在风险信号。</p>
                
                <div class="risk-indicators">
                    <div class="risk-card">
                        <div class="risk-title">盈利能力风险</div>
                        <div class="risk-description">
                            连续亏损、毛利率下降、净利润波动大、ROE/ROA持续下降
                        </div>
                    </div>
                    
                    <div class="risk-card">
                        <div class="risk-title">偿债能力风险</div>
                        <div class="risk-description">
                            高负债率、流动比率低、利息保障倍数不足、短期债务占比高
                        </div>
                    </div>
                    
                    <div class="risk-card">
                        <div class="risk-title">现金流风险</div>
                        <div class="risk-description">
                            经营活动现金流为负、现金流与利润不匹配、依赖融资活动现金流
                        </div>
                    </div>
                    
                    <div class="risk-card">
                        <div class="risk-title">运营效率风险</div>
                        <div class="risk-description">
                            资产周转率低、应收账款回收慢、存货积压、营运资本管理不善
                        </div>
                    </div>
                </div>
                
                <div class="panel">
                    <h3>风险识别练习</h3>
                    <p>根据以下财务情景，识别潜在的财务风险：</p>
                    
                    <div class="analysis-result" style="margin-top: 15px;">
                        <div class="result-description">
                            <p><strong>情景1：</strong> 某公司连续三年营业收入增长超过50%，但经营活动现金流持续为负，且应收账款大幅增加。</p>
                            <div class="form-group">
                                <label>这反映了什么风险？</label>
                                <select id="risk-question-1">
                                    <option value="">请选择...</option>
                                    <option value="profitability">盈利能力风险</option>
                                    <option value="cashflow" data-correct="true">现金流风险</option>
                                    <option value="solvency">偿债能力风险</option>
                                    <option value="efficiency">运营效率风险</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="result-description" style="margin-top: 15px;">
                            <p><strong>情景2：</strong> 某公司资产负债率高达85%，流动比率仅为0.8，且利息保障倍数为负数。</p>
                            <div class="form-group">
                                <label>这反映了什么风险？</label>
                                <select id="risk-question-2">
                                    <option value="">请选择...</option>
                                    <option value="profitability">盈利能力风险</option>
                                    <option value="cashflow">现金流风险</option>
                                    <option value="solvency" data-correct="true">偿债能力风险</option>
                                    <option value="efficiency">运营效率风险</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="result-description" style="margin-top: 15px;">
                            <p><strong>情景3：</strong> 某公司毛利率从35%下降至15%，净利润率从12%下降至2%，ROE从18%下降至5%。</p>
                            <div class="form-group">
                                <label>这反映了什么风险？</label>
                                <select id="risk-question-3">
                                    <option value="">请选择...</option>
                                    <option value="profitability" data-correct="true">盈利能力风险</option>
                                    <option value="cashflow">现金流风险</option>
                                    <option value="solvency">偿债能力风险</option>
                                    <option value="efficiency">运营效率风险</option>
                                </select>
                            </div>
                        </div>
                        
                        <button class="btn" id="check-risk-answers" style="margin-top: 15px;">检查答案</button>
                        
                        <div class="result-description" id="risk-answers-result" style="display: none; margin-top: 15px;"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="case-study" class="tab-content">
            <div class="panel">
                <h2 class="panel-title">瑞幸咖啡财务造假案例分析</h2>
                <p>分析瑞幸咖啡财务造假事件，学习识别财务欺诈的方法。</p>
                
                <div class="panel">
                    <h3>案例背景</h3>
                    <div class="result-description">
                        <p>瑞幸咖啡成立于2017年，以快速扩张和低价策略迅速占领中国市场。2020年4月，公司自曝财务造假，承认2019年第二季度至第四季度虚增了约22亿元人民币的交易额。</p>
                        
                        <p><strong>造假手段：</strong></p>
                        <ul style="padding-left: 20px; margin-top: 10px;">
                            <li>虚构交易：通过关联方伪造销售交易</li>
                            <li>虚增收入：夸大销售额和门店销量</li>
                            <li>虚减成本：少报营销和运营费用</li>
                            <li>伪造现金流：通过复杂交易结构伪造现金流</li>
                        </ul>
                    </div>
                </div>
                
                <div class="panel">
                    <h3>造假前的财务异常信号</h3>
                    <div class="financial-statements">
                        <div class="statement-card">
                            <div class="statement-title">收入异常</div>
                            <div class="statement-item">
                                <span>单店日均销量</span>
                                <span>263件 (虚报)</span>
                            </div>
                            <div class="statement-item">
                                <span>实际单店日均销量</span>
                                <span>约100件 (实际)</span>
                            </div>
                            <div class="statement-item">
                                <span>收入增长率</span>
                                <span>异常高 (>500%)</span>
                            </div>
                        </div>
                        
                        <div class="statement-card">
                            <div class="statement-title">现金流异常</div>
                            <div class="statement-item">
                                <span>经营活动现金流</span>
                                <span>-12.3亿元</span>
                            </div>
                            <div class="statement-item">
                                <span>净利润</span>
                                <span>-31.6亿元</span>
                            </div>
                            <div class="statement-item">
                                <span>现金流/利润差异</span>
                                <span>巨大差异</span>
                            </div>
                        </div>
                        
                        <div class="statement-card">
                            <div class="statement-title">运营指标异常</div>
                            <div class="statement-item">
                                <span>单杯成本</span>
                                <span>远低于行业</span>
                            </div>
                            <div class="statement-item">
                                <span>折扣率</span>
                                <span>异常高 (>50%)</span>
                            </div>
                            <div class="statement-item">
                                <span>客户复购率</span>
                                <span>与收入不匹配</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="panel">
                    <h3>识别财务造假的警示信号</h3>
                    <div class="risk-indicators">
                        <div class="risk-card">
                            <div class="risk-title">财务指标异常</div>
                            <div class="risk-description">
                                收入增长与行业趋势不符、毛利率异常高、现金流与利润不匹配
                            </div>
                        </div>
                        
                        <div class="risk-card">
                            <div class="risk-title">运营数据矛盾</div>
                            <div class="risk-description">
                                单店销量与客单价不匹配、客户数量与收入增长不一致
                            </div>
                        </div>
                        
                        <div class="risk-card">
                            <div class="risk-title">关联方交易</div>
                            <div class="risk-description">
                                与关联方的大量交易、交易价格不公允、交易缺乏商业实质
                            </div>
                        </div>
                        
                        <div class="risk-card">
                            <div class="risk-title">审计问题</div>
                            <div class="risk-description">
                                频繁更换审计师、审计意见异常、内部控制缺陷
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="analysis-result">
                    <div class="result-score">案例学习要点</div>
                    <div class="result-description">
                        <p>1. <strong>交叉验证：</strong> 财务数据应与运营数据、行业趋势和宏观经济环境一致</p>
                        <p>2. <strong>关注现金流：</strong> 利润可以操纵，但现金流更难伪造，关注现金流与利润的差异</p>
                        <p>3. <strong>分析业务模式：</strong> 理解公司的商业模式和盈利逻辑，判断财务数据是否合理</p>
                        <p>4. <strong>警惕异常增长：</strong> 异常高的增长率可能意味着财务操纵，特别是当与行业趋势不符时</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="instructions">
            <h3>学习目标</h3>
            <ol>
                <li>理解三大财务报表（利润表、资产负债表、现金流量表）的结构和内容</li>
                <li>掌握关键财务比率的计算方法和分析意义</li>
                <li>学会使用主要估值方法（DDM、P/E、DCF）评估公司价值</li>
                <li>能够识别财务报表中的潜在风险和异常信号</li>
                <li>通过案例分析理解财务造假的常见手段和识别方法</li>
            </ol>
            <p><strong>学习重点：</strong>通过公司财务侦探模拟，深入理解财务报表分析、公司估值和风险识别，培养基于财务分析的投资决策能力。</p>
        </div>
    </div>

    <script>
        // 公司数据
        const companies = {
            'luckin': {
                name: '瑞幸咖啡',
                description: '快速扩张的咖啡连锁品牌，曾因财务造假闻名',
                financials: {
                    // 利润表数据 (亿元)
                    revenue: 13.2,
                    operatingCosts: 9.8,
                    grossProfit: 3.4,
                    operatingExpenses: 4.1,
                    operatingProfit: -0.7,
                    netIncome: -0.5,
                    
                    // 资产负债表数据 (亿元)
                    cash: 5.2,
                    receivables: 1.8,
                    inventory: 0.9,
                    fixedAssets: 8.7,
                    totalAssets: 16.6,
                    totalLiabilities: 12.3,
                    equity: 4.3,
                    
                    // 现金流量表数据 (亿元)
                    operatingCashFlow: -0.3,
                    investingCashFlow: -2.1,
                    financingCashFlow: 2.5,
                    netCashChange: 0.1,
                    
                    // 财务比率
                    grossMargin: 25.8,
                    netMargin: -3.8,
                    roe: -11.6,
                    roa: -3.0,
                    currentRatio: 1.2,
                    quickRatio: 0.9,
                    debtRatio: 74.1,
                    interestCoverage: -2.5,
                    receivablesTurnover: 7.3,
                    inventoryTurnover: 10.9,
                    assetTurnover: 0.8
                }
            },
            'apple': {
                name: '苹果公司',
                description: '全球领先的科技公司，产品包括iPhone、iPad等',
                financials: {
                    // 利润表数据 (亿元)
                    revenue: 365.8,
                    operatingCosts: 215.4,
                    grossProfit: 150.4,
                    operatingExpenses: 55.7,
                    operatingProfit: 94.7,
                    netIncome: 94.7,
                    
                    // 资产负债表数据 (亿元)
                    cash: 48.3,
                    receivables: 21.5,
                    inventory: 6.4,
                    fixedAssets: 42.5,
                    totalAssets: 351.0,
                    totalLiabilities: 258.5,
                    equity: 92.5,
                    
                    // 现金流量表数据 (亿元)
                    operatingCashFlow: 104.0,
                    investingCashFlow: -45.6,
                    financingCashFlow: -58.4,
                    netCashChange: 0.0,
                    
                    // 财务比率
                    grossMargin: 41.1,
                    netMargin: 25.9,
                    roe: 102.4,
                    roa: 27.0,
                    currentRatio: 1.1,
                    quickRatio: 1.0,
                    debtRatio: 73.7,
                    interestCoverage: 18.5,
                    receivablesTurnover: 17.0,
                    inventoryTurnover: 33.7,
                    assetTurnover: 1.04
                }
            },
            'tesla': {
                name: '特斯拉',
                description: '电动汽车和清洁能源公司，颠覆传统汽车行业',
                financials: {
                    // 利润表数据 (亿元)
                    revenue: 81.5,
                    operatingCosts: 62.1,
                    grossProfit: 19.4,
                    operatingExpenses: 6.8,
                    operatingProfit: 12.6,
                    netIncome: 12.6,
                    
                    // 资产负债表数据 (亿元)
                    cash: 18.9,
                    receivables: 3.2,
                    inventory: 5.8,
                    fixedAssets: 28.7,
                    totalAssets: 82.3,
                    totalLiabilities: 28.5,
                    equity: 53.8,
                    
                    // 现金流量表数据 (亿元)
                    operatingCashFlow: 8.9,
                    investingCashFlow: -15.2,
                    financingCashFlow: 6.3,
                    netCashChange: 0.0,
                    
                    // 财务比率
                    grossMargin: 23.8,
                    netMargin: 15.5,
                    roe: 23.4,
                    roa: 15.3,
                    currentRatio: 1.5,
                    quickRatio: 1.3,
                    debtRatio: 34.6,
                    interestCoverage: 8.2,
                    receivablesTurnover: 25.5,
                    inventoryTurnover: 10.7,
                    assetTurnover: 0.99
                }
            },
            'coca-cola': {
                name: '可口可乐',
                description: '全球知名饮料公司，拥有强大的品牌价值',
                financials: {
                    // 利润表数据 (亿元)
                    revenue: 43.0,
                    operatingCosts: 17.2,
                    grossProfit: 25.8,
                    operatingExpenses: 16.3,
                    operatingProfit: 9.5,
                    netIncome: 9.5,
                    
                    // 资产负债表数据 (亿元)
                    cash: 9.8,
                    receivables: 3.5,
                    inventory: 3.2,
                    fixedAssets: 15.6,
                    totalAssets: 92.7,
                    totalLiabilities: 69.2,
                    equity: 23.5,
                    
                    // 现金流量表数据 (亿元)
                    operatingCashFlow: 11.2,
                    investingCashFlow: -4.8,
                    financingCashFlow: -6.4,
                    netCashChange: 0.0,
                    
                    // 财务比率
                    grossMargin: 60.0,
                    netMargin: 22.1,
                    roe: 40.4,
                    roa: 10.3,
                    currentRatio: 1.3,
                    quickRatio: 1.1,
                    debtRatio: 74.6,
                    interestCoverage: 12.8,
                    receivablesTurnover: 12.3,
                    inventoryTurnover: 5.4,
                    assetTurnover: 0.46
                }
            }
        };
        
        let currentCompany = 'luckin';
        let valuationChart;
        let valuationResults = {
            ddm: null,
            pe: null,
            dcf: null
        };
        
        // 初始化函数
        function init() {
            // 标签页切换
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // 公司选择
            document.querySelectorAll('.company-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.company-card').forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    
                    currentCompany = this.getAttribute('data-company');
                    const company = companies[currentCompany];
                    
                    document.getElementById('selected-company-name').textContent = `${company.name} - 财务报表分析`;
                    
                    // 更新财务报表数据
                    updateFinancialStatements(company.financials);
                    
                    // 更新财务比率
                    updateFinancialRatios(company.financials);
                });
            });
            
            // 分析财务健康状况
            document.getElementById('analyze-financials').addEventListener('click', function() {
                const company = companies[currentCompany];
                const score = calculateFinancialHealthScore(company.financials);
                const description = getFinancialHealthDescription(score);
                const riskSignals = getRiskSignals(company.financials);
                
                document.getElementById('financial-health-score').textContent = `财务健康评分: ${score}/100`;
                document.getElementById('financial-health-description').textContent = description;
                document.getElementById('risk-signals').innerHTML = riskSignals;
                document.getElementById('financial-analysis-result').style.display = 'block';
            });
            
            // DDM计算
            document.getElementById('calculate-ddm').addEventListener('click', function() {
                const dividend = parseFloat(document.getElementById('dividend').value);
                const discountRate = parseFloat(document.getElementById('discount-rate').value) / 100;
                const growthRate = parseFloat(document.getElementById('growth-rate').value) / 100;
                
                if (discountRate <= growthRate) {
                    document.getElementById('ddm-result').innerHTML = `<p style="color: var(--accent);">错误：必要收益率必须大于增长率</p>`;
                    return;
                }
                
                const value = dividend / (discountRate - growthRate);
                document.getElementById('ddm-result').innerHTML = `<p>基于DDM模型，每股价值为: <strong>${value.toFixed(2)}元</strong></p>`;
                
                valuationResults.ddm = value;
                updateValuationSummary();
                updateValuationChart();
            });
            
            // 市盈率法计算
            document.getElementById('calculate-pe').addEventListener('click', function() {
                const eps = parseFloat(document.getElementById('eps').value);
                const peRatio = parseFloat(document.getElementById('pe-ratio').value);
                
                const value = eps * peRatio;
                document.getElementById('pe-result').innerHTML = `<p>基于市盈率法，每股价值为: <strong>${value.toFixed(2)}元</strong></p>`;
                
                valuationResults.pe = value;
                updateValuationSummary();
                updateValuationChart();
            });
            
            // DCF计算
            document.getElementById('calculate-dcf').addEventListener('click', function() {
                const fcf = parseFloat(document.getElementById('fcf').value);
                const growthRate = parseFloat(document.getElementById('dcf-growth').value) / 100;
                const discountRate = parseFloat(document.getElementById('dcf-discount').value) / 100;
                
                // 简化DCF计算，假设永续增长
                const value = fcf / (discountRate - growthRate);
                document.getElementById('dcf-result').innerHTML = `<p>基于DCF模型，每股价值为: <strong>${value.toFixed(2)}元</strong></p>`;
                
                valuationResults.dcf = value;
                updateValuationSummary();
                updateValuationChart();
            });
            
            // 检查风险答案
            document.getElementById('check-risk-answers').addEventListener('click', function() {
                let correctCount = 0;
                const questions = ['risk-question-1', 'risk-question-2', 'risk-question-3'];
                
                questions.forEach(questionId => {
                    const select = document.getElementById(questionId);
                    const selectedOption = select.options[select.selectedIndex];
                    
                    if (selectedOption.hasAttribute('data-correct')) {
                        correctCount++;
                        select.style.borderColor = 'var(--success)';
                    } else {
                        select.style.borderColor = 'var(--accent)';
                    }
                });
                
                let resultText = '';
                if (correctCount === 3) {
                    resultText = `<p style="color: var(--success);">优秀！您正确识别了所有财务风险类型。</p>`;
                } else if (correctCount >= 1) {
                    resultText = `<p>您正确识别了 ${correctCount}/3 个风险类型。请继续学习财务风险识别。</p>`;
                } else {
                    resultText = `<p style="color: var(--accent);">您尚未正确识别任何风险类型。请复习财务风险相关知识。</p>`;
                }
                
                document.getElementById('risk-answers-result').innerHTML = resultText;
                document.getElementById('risk-answers-result').style.display = 'block';
            });
            
            // 初始化财务报表和估值图表
            updateFinancialStatements(companies[currentCompany].financials);
            updateFinancialRatios(companies[currentCompany].financials);
            initValuationChart();
            updateValuationSummary();
        }
        
        // 更新财务报表数据
        function updateFinancialStatements(financials) {
            // 更新利润表
            const incomeStatement = document.getElementById('income-statement');
            incomeStatement.innerHTML = `
                <div class="statement-item">
                    <span>营业收入</span>
                    <span>${financials.revenue.toFixed(1)}亿元</span>
                </div>
                <div class="statement-item">
                    <span>营业成本</span>
                    <span>${financials.operatingCosts.toFixed(1)}亿元</span>
                </div>
                <div class="statement-item">
                    <span>毛利润</span>
                    <span>${financials.grossProfit.toFixed(1)}亿元</span>
                </div>
                <div class="statement-item">
                    <span>营业费用</span>
                    <span>${financials.operatingExpenses.toFixed(1)}亿元</span>
                </div>
                <div class="statement-item">
                    <span>营业利润</span>
                    <span>${financials.operatingProfit.toFixed(1)}亿元</span>
                </div>
                <div class="statement-item">
                    <span>净利润</span>
                    <span>${financials.netIncome.toFixed(1)}亿元</span>
                </div>
            `;
            
            // 更新资产负债表
            const balanceSheet = document.getElementById('balance-sheet');
            balanceSheet.innerHTML = `
                <div class="statement-item">
                    <span>现金及等价物</span>
                    <span>${financials.cash.toFixed(1)}亿元</span>
                </div>
                <div class="statement-item">
                    <span>应收账款</span>
                    <span>${financials.receivables.toFixed(1)}亿元</span>
                </div>
                <div class="statement-item">
                    <span>存货</span>
                    <span>${financials.inventory.toFixed(1)}亿元</span>
                </div>
                <div class="statement-item">
                    <span>固定资产</span>
                    <span>${financials.fixedAssets.toFixed(1)}亿元</span>
                </div>
                <div class="statement-item">
                    <span>总资产</span>
                    <span>${financials.totalAssets.toFixed(1)}亿元</span>
                </div>
                <div class="statement-item">
                    <span>总负债</span>
                    <span>${financials.totalLiabilities.toFixed(1)}亿元</span>
                </div>
                <div class="statement-item">
                    <span>股东权益</span>
                    <span>${financials.equity.toFixed(1)}亿元</span>
                </div>
            `;
            
            // 更新现金流量表
            const cashflowStatement = document.getElementById('cashflow-statement');
            cashflowStatement.innerHTML = `
                <div class="statement-item">
                    <span>经营活动现金流</span>
                    <span>${financials.operatingCashFlow.toFixed(1)}亿元</span>
                </div>
                <div class="statement-item">
                    <span>投资活动现金流</span>
                    <span>${financials.investingCashFlow.toFixed(1)}亿元</span>
                </div>
                <div class="statement-item">
                    <span>筹资活动现金流</span>
                    <span>${financials.financingCashFlow.toFixed(1)}亿元</span>
                </div>
                <div class="statement-item">
                    <span>现金净增加</span>
                    <span>${financials.netCashChange.toFixed(1)}亿元</span>
                </div>
            `;
        }
        
        // 更新财务比率
        function updateFinancialRatios(financials) {
            // 更新盈利能力比率
            const profitabilityRatios = document.getElementById('profitability-ratios');
            profitabilityRatios.innerHTML = `
                <div class="statement-item">
                    <span>毛利率</span>
                    <span>${financials.grossMargin.toFixed(1)}%</span>
                </div>
                <div class="statement-item">
                    <span>净利率</span>
                    <span>${financials.netMargin.toFixed(1)}%</span>
                </div>
                <div class="statement-item">
                    <span>ROE (净资产收益率)</span>
                    <span>${financials.roe.toFixed(1)}%</span>
                </div>
                <div class="statement-item">
                    <span>ROA (总资产收益率)</span>
                    <span>${financials.roa.toFixed(1)}%</span>
                </div>
            `;
            
            // 更新偿债能力比率
            const solvencyRatios = document.getElementById('solvency-ratios');
            solvencyRatios.innerHTML = `
                <div class="statement-item">
                    <span>流动比率</span>
                    <span>${financials.currentRatio.toFixed(1)}</span>
                </div>
                <div class="statement-item">
                    <span>速动比率</span>
                    <span>${financials.quickRatio.toFixed(1)}</span>
                </div>
                <div class="statement-item">
                    <span>资产负债率</span>
                    <span>${financials.debtRatio.toFixed(1)}%</span>
                </div>
                <div class="statement-item">
                    <span>利息保障倍数</span>
                    <span>${financials.interestCoverage.toFixed(1)}</span>
                </div>
            `;
            
            // 更新营运能力比率
            const efficiencyRatios = document.getElementById('efficiency-ratios');
            efficiencyRatios.innerHTML = `
                <div class="statement-item">
                    <span>应收账款周转率</span>
                    <span>${financials.receivablesTurnover.toFixed(1)}</span>
                </div>
                <div class="statement-item">
                    <span>存货周转率</span>
                    <span>${financials.inventoryTurnover.toFixed(1)}</span>
                </div>
                <div class="statement-item">
                    <span>总资产周转率</span>
                    <span>${financials.assetTurnover.toFixed(1)}</span>
                </div>
            `;
        }
        
        // 计算财务健康评分
        function calculateFinancialHealthScore(financials) {
            let score = 100;
            
            // 盈利能力评分
            if (financials.netIncome < 0) score -= 30;
            else if (financials.netIncome / financials.revenue < 0.05) score -= 15;
            
            // 偿债能力评分
            const debtRatio = financials.debtRatio / 100;
            if (debtRatio > 0.7) score -= 20;
            else if (debtRatio > 0.5) score -= 10;
            
            // 现金流评分
            if (financials.operatingCashFlow < 0) score -= 20;
            else if (financials.operatingCashFlow / financials.revenue < 0.1) score -= 10;
            
            // 增长性评分
            // 这里简化处理，实际中需要历史数据
            if (financials.revenue < 10) score -= 10;
            
            return Math.max(0, score);
        }
        
        // 获取财务健康描述
        function getFinancialHealthDescription(score) {
            if (score >= 80) {
                return "公司财务状况健康，盈利能力强，负债水平合理，现金流充裕。";
            } else if (score >= 60) {
                return "公司财务状况一般，存在一些风险因素，需要关注。";
            } else if (score >= 40) {
                return "公司财务状况较差，存在明显风险，投资需谨慎。";
            } else {
                return "公司财务状况恶劣，存在严重风险，建议避免投资。";
            }
        }
        
        // 获取风险信号
        function getRiskSignals(financials) {
            let signals = '';
            
            if (financials.netIncome < 0) {
                signals += '<p>❌ 公司处于亏损状态，盈利能力存在问题</p>';
            }
            
            if (financials.debtRatio > 70) {
                signals += '<p>❌ 负债率过高，偿债压力大</p>';
            }
            
            if (financials.operatingCashFlow < 0) {
                signals += '<p>❌ 经营活动现金流为负，依赖外部融资</p>';
            }
            
            if (financials.netIncome > 0 && financials.operatingCashFlow < 0) {
                signals += '<p>❌ 利润与现金流不匹配，可能存在收入质量问题</p>';
            }
            
            if (signals === '') {
                signals = '<p>✅ 未发现明显风险信号</p>';
            }
            
            return signals;
        }
        
        // 更新估值汇总
        function updateValuationSummary() {
            const summaryContainer = document.getElementById('valuation-summary');
            let summaryHTML = '';
            
            if (valuationResults.ddm !== null) {
                summaryHTML += `
                    <div class="summary-card">
                        <div class="summary-title">DDM估值</div>
                        <div class="summary-value">${valuationResults.ddm.toFixed(2)}元</div>
                    </div>
                `;
            }
            
            if (valuationResults.pe !== null) {
                summaryHTML += `
                    <div class="summary-card">
                        <div class="summary-title">P/E估值</div>
                        <div class="summary-value">${valuationResults.pe.toFixed(2)}元</div>
                    </div>
                `;
            }
            
            if (valuationResults.dcf !== null) {
                summaryHTML += `
                    <div class="summary-card">
                        <div class="summary-title">DCF估值</div>
                        <div class="summary-value">${valuationResults.dcf.toFixed(2)}元</div>
                    </div>
                `;
            }
            
            if (summaryHTML === '') {
                summaryHTML = '<p>请使用至少一种估值方法进行计算</p>';
            }
            
            summaryContainer.innerHTML = summaryHTML;
        }
        
        // 更新估值图表
        function updateValuationChart() {
            if (!valuationChart) return;
            
            const labels = [];
            const data = [];
            const colors = [];
            
            if (valuationResults.ddm !== null) {
                labels.push('DDM');
                data.push(valuationResults.ddm);
                colors.push('rgba(52, 152, 219, 0.7)');
            }
            
            if (valuationResults.pe !== null) {
                labels.push('P/E');
                data.push(valuationResults.pe);
                colors.push('rgba(46, 204, 113, 0.7)');
            }
            
            if (valuationResults.dcf !== null) {
                labels.push('DCF');
                data.push(valuationResults.dcf);
                colors.push('rgba(155, 89, 182, 0.7)');
            }
            
            valuationChart.data.labels = labels;
            valuationChart.data.datasets[0].data = data;
            valuationChart.data.datasets[0].backgroundColor = colors;
            valuationChart.update();
        }
        
        // 初始化估值图表
        function initValuationChart() {
            const ctx = document.getElementById('valuation-chart').getContext('2d');
            
            valuationChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: '估值结果 (元)',
                        data: [],
                        backgroundColor: [],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '估值 (元)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        // 初始化应用
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>