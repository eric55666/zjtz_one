<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>宏观经济侦探 - 数据分析与投资决策模拟</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #34495e;
            --success: #2ecc71;
            --warning: #f39c12;
            --gdp: #3498db;
            --cpi: #e74c3c;
            --unemployment: #f39c12;
            --interest: #9b59b6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 30px 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .game-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 900px) {
            .game-container {
                grid-template-columns: 1fr;
            }
        }
        
        .panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }
        
        .panel-title {
            font-size: 1.4rem;
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light);
        }
        
        .data-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .data-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            text-align: center;
            border-top: 4px solid var(--secondary);
            transition: transform 0.3s;
        }
        
        .data-card.gdp {
            border-top-color: var(--gdp);
        }
        
        .data-card.cpi {
            border-top-color: var(--cpi);
        }
        
        .data-card.unemployment {
            border-top-color: var(--unemployment);
        }
        
        .data-card.interest {
            border-top-color: var(--interest);
        }
        
        .data-card:hover {
            transform: translateY(-5px);
        }
        
        .data-name {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .data-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .data-change {
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .data-change.positive {
            color: var(--success);
        }
        
        .data-change.negative {
            color: var(--accent);
        }
        
        .chart-container {
            height: 300px;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            padding: 15px;
        }
        
        .time-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .time-btn {
            padding: 8px 15px;
            background: var(--light);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .time-btn.active {
            background: var(--secondary);
            color: white;
        }
        
        .analysis-panel {
            background: var(--light);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .analysis-question {
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .analysis-options {
            margin-bottom: 15px;
        }
        
        .analysis-option {
            display: block;
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .analysis-option:hover {
            background: #e0f0ff;
        }
        
        .analysis-option.selected {
            background: var(--secondary);
            color: white;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: var(--primary);
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-accent {
            background: var(--accent);
        }
        
        .investment-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .investment-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .investment-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .investment-card.selected {
            border-color: var(--secondary);
            background: rgba(52, 152, 219, 0.05);
        }
        
        .investment-name {
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .investment-description {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
        }
        
        .allocation-slider {
            margin-top: 10px;
        }
        
        .allocation-value {
            font-weight: 600;
            margin-top: 5px;
        }
        
        .portfolio-summary {
            background: var(--light);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .portfolio-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #ddd;
        }
        
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            background: var(--light);
        }
        
        .scenario-description {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .instructions {
            background: var(--light);
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
        }
        
        .instructions h3 {
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        .instructions ol {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 10px;
        }
        
        .macro-indicators {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .indicator-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .indicator-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .performance-chart {
            height: 250px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>宏观经济侦探</h1>
            <p class="subtitle">分析宏观经济数据 | 预测市场趋势 | 联系国家发展做出投资决策</p>
        </header>
        
        <div class="game-container">
            <div class="panel">
                <h2 class="panel-title">宏观经济数据看板</h2>
                
                <div class="data-cards">
                    <div class="data-card gdp">
                        <div class="data-name">GDP增长率</div>
                        <div class="data-value">5.2%</div>
                        <div class="data-change positive">+0.3%</div>
                    </div>
                    
                    <div class="data-card cpi">
                        <div class="data-name">CPI通胀率</div>
                        <div class="data-value">2.1%</div>
                        <div class="data-change positive">+0.2%</div>
                    </div>
                    
                    <div class="data-card unemployment">
                        <div class="data-name">失业率</div>
                        <div class="data-value">5.0%</div>
                        <div class="data-change negative">-0.1%</div>
                    </div>
                    
                    <div class="data-card interest">
                        <div class="data-name">基准利率</div>
                        <div class="data-value">3.5%</div>
                        <div class="data-change">不变</div>
                    </div>
                </div>
                
                <div class="time-controls">
                    <button class="time-btn active" data-period="1Y">1年</button>
                    <button class="time-btn" data-period="3Y">3年</button>
                    <button class="time-btn" data-period="5Y">5年</button>
                </div>
                
                <div class="chart-container">
                    <canvas id="macro-chart"></canvas>
                </div>
                
                <div class="scenario-description">
                    <h3>当前经济背景</h3>
                    <p>当前经济处于复苏阶段，GDP保持稳定增长，通胀温和上升，就业市场持续改善。央行维持适度宽松的货币政策以支持经济增长。</p>
                    <p>主要风险：外部环境不确定性增加，国际贸易摩擦可能影响出口；房地产市场价格上涨过快可能引发调控。</p>
                </div>
            </div>
            
            <div class="panel">
                <h2 class="panel-title">数据分析与预测</h2>
                
                <div class="analysis-panel">
                    <div class="analysis-question">问题1: 基于当前宏观经济数据，您对股市未来表现的预期是？</div>
                    <div class="analysis-options">
                        <div class="analysis-option" data-correct="true">A. 看好 - GDP增长稳健，企业盈利预期良好</div>
                        <div class="analysis-option">B. 看淡 - 通胀上升可能引发货币政策收紧</div>
                        <div class="analysis-option">C. 中性 - 多空因素交织，市场可能震荡</div>
                    </div>
                    
                    <div class="analysis-question">问题2: 当前经济环境对债券市场的影响主要是？</div>
                    <div class="analysis-options">
                        <div class="analysis-option">A. 利好 - 经济增速放缓将推动债券价格上涨</div>
                        <div class="analysis-option" data-correct="true">B. 利空 - 通胀温和上升可能推高利率，压制债券价格</div>
                        <div class="analysis-option">C. 中性 - 经济增长与通胀相互抵消，影响有限</div>
                    </div>
                    
                    <div class="analysis-question">问题3: 在当前宏观经济背景下，哪些行业可能表现较好？</div>
                    <div class="analysis-options">
                        <div class="analysis-option" data-correct="true">A. 科技和消费 - 经济复苏推动消费升级和数字化转型</div>
                        <div class="analysis-option">B. 能源和原材料 - 通胀上升推高大宗商品价格</div>
                        <div class="analysis-option" data-correct="true">C. 金融 - 利率环境改善有利于银行业绩</div>
                    </div>
                    
                    <button class="btn btn-success" id="submit-analysis">提交分析</button>
                    
                    <div class="result" id="analysis-result" style="display: none;">
                        <h3>分析结果</h3>
                        <p>您的得分: <span id="analysis-score">0</span>/3</p>
                        <p id="analysis-feedback"></p>
                    </div>
                </div>
                
                <div class="panel">
                    <h3>投资决策模拟</h3>
                    <p>基于您的宏观经济分析，请分配100万元投资资金：</p>
                    
                    <div class="investment-options">
                        <div class="investment-card" data-asset="stocks">
                            <div class="investment-name">股票</div>
                            <div class="investment-description">受益于经济增长，但受市场情绪影响较大</div>
                            <div class="allocation-slider">
                                <input type="range" min="0" max="100" value="30" class="asset-slider" data-asset="stocks">
                            </div>
                            <div class="allocation-value">30% - 30万元</div>
                        </div>
                        
                        <div class="investment-card" data-asset="bonds">
                            <div class="investment-name">债券</div>
                            <div class="investment-description">相对稳定，但受利率变化影响</div>
                            <div class="allocation-slider">
                                <input type="range" min="0" max="100" value="30" class="asset-slider" data-asset="bonds">
                            </div>
                            <div class="allocation-value">30% - 30万元</div>
                        </div>
                        
                        <div class="investment-card" data-asset="real-estate">
                            <div class="investment-name">房地产</div>
                            <div class="investment-description">抗通胀，但受政策调控影响</div>
                            <div class="allocation-slider">
                                <input type="range" min="0" max="100" value="20" class="asset-slider" data-asset="real-estate">
                            </div>
                            <div class="allocation-value">20% - 20万元</div>
                        </div>
                        
                        <div class="investment-card" data-asset="cash">
                            <div class="investment-name">现金</div>
                            <div class="investment-description">流动性高，但收益率较低</div>
                            <div class="allocation-slider">
                                <input type="range" min="0" max="100" value="20" class="asset-slider" data-asset="cash">
                            </div>
                            <div class="allocation-value">20% - 20万元</div>
                        </div>
                    </div>
                    
                    <div class="portfolio-summary">
                        <h4>投资组合汇总</h4>
                        <div class="portfolio-item">
                            <span>股票</span>
                            <span id="stocks-allocation">30万元 (30%)</span>
                        </div>
                        <div class="portfolio-item">
                            <span>债券</span>
                            <span id="bonds-allocation">30万元 (30%)</span>
                        </div>
                        <div class="portfolio-item">
                            <span>房地产</span>
                            <span id="real-estate-allocation">20万元 (20%)</span>
                        </div>
                        <div class="portfolio-item">
                            <span>现金</span>
                            <span id="cash-allocation">20万元 (20%)</span>
                        </div>
                        <div class="portfolio-item" style="font-weight: 600; border-bottom: none;">
                            <span>总投资</span>
                            <span>100万元 (100%)</span>
                        </div>
                    </div>
                    
                    <button class="btn" id="execute-investment" style="margin-top: 15px;">执行投资</button>
                    
                    <div class="result" id="investment-result" style="display: none;">
                        <h3>投资结果</h3>
                        <div id="investment-outcome"></div>
                        <div class="performance-chart">
                            <canvas id="performance-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="panel">
            <h2 class="panel-title">宏观经济指标解读</h2>
            
            <div class="macro-indicators">
                <div class="indicator-card">
                    <div class="indicator-title">GDP增长率</div>
                    <p>衡量一个国家经济总体增长水平的核心指标。持续稳定的GDP增长通常意味着经济健康发展，企业盈利改善，有利于股市表现。</p>
                </div>
                
                <div class="indicator-card">
                    <div class="indicator-title">CPI通胀率</div>
                    <p>反映消费品和服务价格变动的指标。适度的通胀有利于经济，但过高通胀可能引发货币政策收紧，对股市和债市产生压力。</p>
                </div>
                
                <div class="indicator-card">
                    <div class="indicator-title">失业率</div>
                    <p>衡量劳动力市场状况的关键指标。低失业率通常意味着经济强劲，消费能力增强，但可能推高工资和通胀。</p>
                </div>
                
                <div class="indicator-card">
                    <div class="indicator-title">基准利率</div>
                    <p>央行设定的关键利率，影响整个经济的借贷成本。低利率环境通常有利于风险资产如股票，而不利于固定收益资产如债券。</p>
                </div>
            </div>
        </div>
        
        <div class="instructions">
            <h3>学习目标</h3>
            <ol>
                <li>理解主要宏观经济指标（GDP、CPI、失业率、利率）的含义和影响</li>
                <li>掌握宏观经济数据与金融市场表现之间的关系</li>
                <li>学会基于宏观经济分析预测市场趋势</li>
                <li>能够根据宏观经济环境制定合理的投资策略</li>
                <li>理解国家经济发展与个人投资决策的关联</li>
            </ol>
            <p><strong>学习重点：</strong>通过分析宏观经济数据，理解经济周期与资产表现的关系，培养基于宏观经济的投资决策能力。</p>
        </div>
    </div>

    <script>
        // 宏观经济数据
        const macroData = {
            labels: ['2018', '2019', '2020', '2021', '2022', '2023'],
            datasets: [
                {
                    label: 'GDP增长率 (%)',
                    data: [6.7, 6.0, 2.3, 8.1, 5.5, 5.2],
                    borderColor: '#3498db',
                    backgroundColor: 'rgba(52, 152, 219, 0.1)',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.4
                },
                {
                    label: 'CPI通胀率 (%)',
                    data: [2.1, 2.9, 2.5, 1.8, 2.0, 2.1],
                    borderColor: '#e74c3c',
                    backgroundColor: 'rgba(231, 76, 60, 0.1)',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.4
                },
                {
                    label: '失业率 (%)',
                    data: [4.9, 5.2, 5.6, 5.1, 5.2, 5.0],
                    borderColor: '#f39c12',
                    backgroundColor: 'rgba(243, 156, 18, 0.1)',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.4
                }
            ]
        };
        
        // 资产表现数据（基于当前宏观经济环境）
        const assetPerformance = {
            stocks: 8.5,    // 股票预期年化收益率
            bonds: 2.5,     // 债券预期年化收益率
            realEstate: 5.0, // 房地产预期年化收益率
            cash: 1.5       // 现金预期年化收益率
        };
        
        let macroChart, performanceChart;
        
        // 初始化函数
        function init() {
            // 初始化宏观经济图表
            initMacroChart();
            
            // 初始化滑块事件
            initSliders();
            
            // 分析题目提交
            document.getElementById('submit-analysis').addEventListener('click', function() {
                let score = 0;
                const questions = document.querySelectorAll('.analysis-question');
                
                questions.forEach((question, index) => {
                    const options = question.nextElementSibling.querySelectorAll('.analysis-option');
                    let correctCount = 0;
                    let selectedCorrectCount = 0;
                    
                    options.forEach(option => {
                        if (option.hasAttribute('data-correct') && option.getAttribute('data-correct') === 'true') {
                            correctCount++;
                            if (option.classList.contains('selected')) {
                                selectedCorrectCount++;
                            }
                        }
                    });
                    
                    // 多选题目需要全部选对才能得分
                    if (correctCount > 1) {
                        if (selectedCorrectCount === correctCount) {
                            let allCorrectSelected = true;
                            options.forEach(option => {
                                if (!option.hasAttribute('data-correct') || option.getAttribute('data-correct') === 'false') {
                                    if (option.classList.contains('selected')) {
                                        allCorrectSelected = false;
                                    }
                                }
                            });
                            if (allCorrectSelected) {
                                score++;
                            }
                        }
                    } else {
                        // 单选题
                        const selectedOption = question.nextElementSibling.querySelector('.analysis-option.selected');
                        if (selectedOption && selectedOption.getAttribute('data-correct') === 'true') {
                            score++;
                        }
                    }
                });
                
                document.getElementById('analysis-score').textContent = score;
                document.getElementById('analysis-result').style.display = 'block';
                
                let feedback = '';
                if (score === 3) {
                    feedback = '优秀！您对宏观经济与市场关系有深入的理解。';
                } else if (score >= 2) {
                    feedback = '良好！您对宏观经济分析有基本把握，但还需要进一步学习。';
                } else {
                    feedback = '需要加强学习！建议重新学习宏观经济指标与市场关系相关知识。';
                }
                
                document.getElementById('analysis-feedback').textContent = feedback;
            });
            
            // 分析选项选择
            document.querySelectorAll('.analysis-option').forEach(option => {
                option.addEventListener('click', function() {
                    const question = this.closest('.analysis-options');
                    const isMultiple = question.querySelectorAll('[data-correct="true"]').length > 1;
                    
                    if (isMultiple) {
                        // 多选题目
                        this.classList.toggle('selected');
                    } else {
                        // 单选题目
                        question.querySelectorAll('.analysis-option').forEach(o => o.classList.remove('selected'));
                        this.classList.add('selected');
                    }
                });
            });
            
            // 执行投资
            document.getElementById('execute-investment').addEventListener('click', function() {
                const stocksAllocation = parseInt(document.querySelector('.asset-slider[data-asset="stocks"]').value);
                const bondsAllocation = parseInt(document.querySelector('.asset-slider[data-asset="bonds"]').value);
                const realEstateAllocation = parseInt(document.querySelector('.asset-slider[data-asset="real-estate"]').value);
                const cashAllocation = parseInt(document.querySelector('.asset-slider[data-asset="cash"]').value);
                
                // 计算总投资收益率
                const totalReturn = 
                    (stocksAllocation * assetPerformance.stocks + 
                     bondsAllocation * assetPerformance.bonds + 
                     realEstateAllocation * assetPerformance.realEstate + 
                     cashAllocation * assetPerformance.cash) / 100;
                
                // 计算各资产收益
                const stocksReturn = (stocksAllocation * assetPerformance.stocks) / 100;
                const bondsReturn = (bondsAllocation * assetPerformance.bonds) / 100;
                const realEstateReturn = (realEstateAllocation * assetPerformance.realEstate) / 100;
                const cashReturn = (cashAllocation * assetPerformance.cash) / 100;
                
                let outcomeText = `
                    <p>基于当前宏观经济环境，您的投资组合一年后表现：</p>
                    <div class="portfolio-summary" style="margin-top: 15px;">
                        <div class="portfolio-item">
                            <span>股票投资回报</span>
                            <span>${stocksReturn.toFixed(2)}万元 (${assetPerformance.stocks}%)</span>
                        </div>
                        <div class="portfolio-item">
                            <span>债券投资回报</span>
                            <span>${bondsReturn.toFixed(2)}万元 (${assetPerformance.bonds}%)</span>
                        </div>
                        <div class="portfolio-item">
                            <span>房地产投资回报</span>
                            <span>${realEstateReturn.toFixed(2)}万元 (${assetPerformance.realEstate}%)</span>
                        </div>
                        <div class="portfolio-item">
                            <span>现金收益</span>
                            <span>${cashReturn.toFixed(2)}万元 (${assetPerformance.cash}%)</span>
                        </div>
                        <div class="portfolio-item" style="font-weight: 600; border-bottom: none;">
                            <span>总投资回报</span>
                            <span>${totalReturn.toFixed(2)}万元 (${totalReturn.toFixed(2)}%)</span>
                        </div>
                    </div>
                    <p style="margin-top: 15px;"><strong>投资分析：</strong> ${getInvestmentAnalysis(stocksAllocation, totalReturn)}</p>
                `;
                
                document.getElementById('investment-outcome').innerHTML = outcomeText;
                document.getElementById('investment-result').style.display = 'block';
                
                // 初始化绩效图表
                initPerformanceChart(stocksAllocation, bondsAllocation, realEstateAllocation, cashAllocation);
            });
            
            // 时间周期选择
            document.querySelectorAll('.time-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const period = this.getAttribute('data-period');
                    updateMacroChart(period);
                });
            });
        }
        
        // 初始化宏观经济图表
        function initMacroChart() {
            const ctx = document.getElementById('macro-chart').getContext('2d');
            
            macroChart = new Chart(ctx, {
                type: 'line',
                data: macroData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'nearest'
                    }
                }
            });
        }
        
        // 更新宏观经济图表
        function updateMacroChart(period) {
            // 在实际应用中，这里会根据选择的时间周期从服务器获取数据
            // 这里仅作演示，不实际更新数据
            console.log(`更新图表数据，时间周期: ${period}`);
        }
        
        // 初始化滑块
        function initSliders() {
            const sliders = document.querySelectorAll('.asset-slider');
            const totalBudget = 100; // 100万元
            
            sliders.forEach(slider => {
                slider.addEventListener('input', function() {
                    const asset = this.getAttribute('data-asset');
                    const value = parseInt(this.value);
                    
                    // 更新显示值
                    document.querySelector(`.investment-card[data-asset="${asset}"] .allocation-value`).textContent = 
                        `${value}% - ${value}万元`;
                    
                    // 更新投资组合汇总
                    document.getElementById(`${asset}-allocation`).textContent = 
                        `${value}万元 (${value}%)`;
                    
                    // 重新平衡其他滑块，确保总和为100%
                    rebalanceSliders(asset, value);
                });
            });
        }
        
        // 重新平衡滑块
        function rebalanceSliders(changedAsset, newValue) {
            const sliders = document.querySelectorAll('.asset-slider');
            let total = 0;
            let changedSliderValue = 0;
            
            // 计算当前总值和更改的滑块值
            sliders.forEach(slider => {
                const asset = slider.getAttribute('data-asset');
                const value = parseInt(slider.value);
                
                if (asset === changedAsset) {
                    changedSliderValue = newValue;
                    total += newValue;
                } else {
                    total += value;
                }
            });
            
            // 如果总和超过100%，按比例减少其他滑块的值
            if (total > 100) {
                const excess = total - 100;
                const otherSliders = Array.from(sliders).filter(slider => 
                    slider.getAttribute('data-asset') !== changedAsset);
                
                let otherTotal = otherSliders.reduce((sum, slider) => sum + parseInt(slider.value), 0);
                
                otherSliders.forEach(slider => {
                    const asset = slider.getAttribute('data-asset');
                    const currentValue = parseInt(slider.value);
                    const newValue = Math.max(0, currentValue - (currentValue / otherTotal) * excess);
                    
                    slider.value = Math.round(newValue);
                    
                    // 更新显示值
                    document.querySelector(`.investment-card[data-asset="${asset}"] .allocation-value`).textContent = 
                        `${Math.round(newValue)}% - ${Math.round(newValue)}万元`;
                    
                    // 更新投资组合汇总
                    document.getElementById(`${asset}-allocation`).textContent = 
                        `${Math.round(newValue)}万元 (${Math.round(newValue)}%)`;
                });
            }
        }
        
        // 获取投资分析
        function getInvestmentAnalysis(stocksAllocation, totalReturn) {
            if (stocksAllocation >= 50 && totalReturn > 6) {
                return "您的投资组合偏重股票，在当前经济复苏环境下获得了较好回报。这种配置适合风险承受能力较强的投资者。";
            } else if (stocksAllocation >= 30 && stocksAllocation < 50 && totalReturn > 4) {
                return "您的投资组合较为均衡，在控制风险的同时获得了稳健回报。这种配置适合大多数投资者。";
            } else if (stocksAllocation < 30 && totalReturn < 4) {
                return "您的投资组合偏保守，虽然风险较低，但在经济复苏阶段可能错失部分增长机会。考虑适度增加股票配置。";
            } else {
                return "您的投资组合配置较为特殊，建议根据个人风险偏好和投资目标进行调整。";
            }
        }
        
        // 初始化绩效图表
        function initPerformanceChart(stocks, bonds, realEstate, cash) {
            const ctx = document.getElementById('performance-chart').getContext('2d');
            
            if (performanceChart) {
                performanceChart.destroy();
            }
            
            performanceChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['股票', '债券', '房地产', '现金'],
                    datasets: [{
                        label: '配置比例 (%)',
                        data: [stocks, bonds, realEstate, cash],
                        backgroundColor: [
                            'rgba(52, 152, 219, 0.7)',
                            'rgba(46, 204, 113, 0.7)',
                            'rgba(155, 89, 182, 0.7)',
                            'rgba(241, 196, 15, 0.7)'
                        ],
                        borderColor: [
                            'rgb(52, 152, 219)',
                            'rgb(46, 204, 113)',
                            'rgb(155, 89, 182)',
                            'rgb(241, 196, 15)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: '配置比例 (%)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `配置比例: ${context.parsed.y}%`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // 初始化应用
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>