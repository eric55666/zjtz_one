<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>基金选择挑战 - 分析基金表现与风险</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #2a3c7f, #3d52a0);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            background: linear-gradient(90deg, #ff9e00, #ffd166);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #a8c0ff;
            margin-bottom: 20px;
        }
        
        .game-area {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
        }
        
        .panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .panel-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #ffd166;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .step {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .step.active {
            display: block;
        }
        
        .fund-analysis {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .fund-analysis {
                grid-template-columns: 1fr;
            }
        }
        
        .fund-chart {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 20px;
            height: 300px;
        }
        
        .fund-details {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 20px;
        }
        
        .fund-name {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 5px;
            color: #ffd166;
        }
        
        .fund-type {
            font-size: 1rem;
            color: #a8c0ff;
            margin-bottom: 15px;
        }
        
        .fund-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stat-label {
            color: #a8c0ff;
        }
        
        .stat-value {
            font-weight: bold;
        }
        
        .positive {
            color: #06d6a0;
        }
        
        .negative {
            color: #ef476f;
        }
        
        .fund-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .fund-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .fund-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .fund-card.selected {
            border-color: #4cc9f0;
            background: rgba(76, 201, 240, 0.1);
        }
        
        .fund-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .fund-card-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffd166;
        }
        
        .fund-card-badge {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 4px 12px;
            font-size: 0.8rem;
        }
        
        .fund-card-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        .fund-card-stat {
            text-align: center;
        }
        
        .fund-card-stat-value {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .fund-card-stat-label {
            font-size: 0.8rem;
            color: #a8c0ff;
        }
        
        .selection-area {
            margin-top: 30px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 20px;
        }
        
        .selection-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        label {
            font-weight: bold;
            color: #ffd166;
        }
        
        select, textarea {
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 1rem;
        }
        
        select option {
            background: rgba(0, 0, 0, 0.8);
            color: white;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .portfolio-management {
            margin-top: 30px;
        }
        
        .portfolio-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .portfolio-area {
                grid-template-columns: 1fr;
            }
        }
        
        .portfolio-chart {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 20px;
            height: 300px;
        }
        
        .portfolio-controls {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 20px;
        }
        
        .portfolio-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .allocation-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .allocation-slider {
            width: 150px;
        }
        
        .allocation-input {
            width: 60px;
            padding: 5px;
            border: none;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            text-align: center;
        }
        
        .remove-btn {
            background: none;
            border: none;
            color: #fff;
            cursor: pointer;
            font-size: 1rem;
            padding: 5px;
        }
        
        .portfolio-summary {
            margin-top: 30px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 20px;
        }
        
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .summary-stat {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-title {
            font-size: 0.9rem;
            color: #a8c0ff;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffd166;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(45deg, #4361ee, #3a0ca3);
            color: white;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        button:disabled {
            background: rgba(255, 255, 255, 0.2);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .learning-advice {
            margin-top: 30px;
        }
        
        .advice-list {
            list-style-type: none;
            padding-left: 0;
            margin-top: 15px;
        }
        
        .advice-item {
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        
        .advice-item:last-child {
            border-bottom: none;
        }
        
        .advice-icon {
            color: #4cc9f0;
            font-size: 1.2rem;
        }
        
        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }
        
        .step-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
        }
        
        .step-dot.active {
            background: #4cc9f0;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .completion-badge {
            display: inline-block;
            background: linear-gradient(45deg, #ff9e00, #ffd166);
            color: #1a2a6c;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            margin-top: 15px;
        }
        
        .feedback {
            margin-top: 15px;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
        }
        
        .feedback.correct {
            background: rgba(6, 214, 160, 0.2);
            border-left: 4px solid #06d6a0;
        }
        
        .feedback.incorrect {
            background: rgba(239, 71, 111, 0.2);
            border-left: 4px solid #ef476f;
        }
        
        .chart-container {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        .performance-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .performance-table th, .performance-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .performance-table th {
            color: #ffd166;
            font-weight: bold;
        }
        
        .time-periods {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .time-period {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .time-period.active {
            background: rgba(76, 201, 240, 0.3);
            color: #4cc9f0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-trophy"></i> 基金选择挑战</h1>
            <div class="subtitle">分析不同基金的表现和风险，选择最佳投资选项，模拟管理基金组合</div>
            <div class="step-indicator">
                <div class="step-dot active" data-step="1"></div>
                <div class="step-dot" data-step="2"></div>
                <div class="step-dot" data-step="3"></div>
                <div class="step-dot" data-step="4"></div>
            </div>
        </header>
        
        <div class="game-area">
            <!-- 步骤1：基金表现分析 -->
            <div class="panel step active" id="step1">
                <div class="panel-title">
                    <i class="fas fa-chart-line"></i> 第一步：基金表现分析
                </div>
                
                <p>分析不同基金的历史表现和风险指标，了解它们的投资特点和适合的投资者类型。</p>
                
                <div class="fund-analysis">
                    <div class="fund-chart">
                        <div class="panel-title" style="margin-bottom: 15px;">
                            <i class="fas fa-chart-bar"></i> 基金表现对比
                        </div>
                        <div class="chart-container" id="performance-chart">
                            <!-- 图表将通过JavaScript生成 -->
                        </div>
                    </div>
                    
                    <div class="fund-details">
                        <div class="panel-title" style="margin-bottom: 15px;">
                            <i class="fas fa-info-circle"></i> 基金详情
                        </div>
                        <div class="fund-name" id="detail-name">请选择基金</div>
                        <div class="fund-type" id="detail-type">--</div>
                        
                        <div class="time-periods">
                            <div class="time-period active" data-period="1y">1年</div>
                            <div class="time-period" data-period="3y">3年</div>
                            <div class="time-period" data-period="5y">5年</div>
                        </div>
                        
                        <div class="fund-stats" id="fund-stats">
                            <!-- 基金统计数据将通过JavaScript动态生成 -->
                        </div>
                    </div>
                </div>
                
                <div class="fund-cards" id="fund-cards">
                    <!-- 基金卡片将通过JavaScript动态生成 -->
                </div>
                
                <div class="performance-table-container">
                    <div class="panel-title" style="margin-top: 25px;">
                        <i class="fas fa-table"></i> 基金表现对比表
                    </div>
                    <table class="performance-table">
                        <thead>
                            <tr>
                                <th>基金名称</th>
                                <th>类型</th>
                                <th>1年收益率</th>
                                <th>3年收益率</th>
                                <th>5年收益率</th>
                                <th>风险等级</th>
                                <th>夏普比率</th>
                            </tr>
                        </thead>
                        <tbody id="performance-table-body">
                            <!-- 表格数据将通过JavaScript动态生成 -->
                        </tbody>
                    </table>
                </div>
                
                <div class="navigation">
                    <div></div> <!-- 占位 -->
                    <button class="btn" id="next-to-selection">
                        下一步：基金选择 <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
            
            <!-- 步骤2：基金选择挑战 -->
            <div class="panel step" id="step2">
                <div class="panel-title">
                    <i class="fas fa-tasks"></i> 第二步：基金选择挑战
                </div>
                
                <p>基于第一步的分析，请选择您认为最适合长期投资的基金，并说明您的选择理由。</p>
                
                <div class="fund-cards">
                    <!-- 基金卡片将通过JavaScript动态生成 -->
                </div>
                
                <div class="selection-area">
                    <div class="selection-form">
                        <div class="form-group">
                            <label for="fund-selection">请选择您认为最适合长期投资的基金：</label>
                            <select id="fund-selection">
                                <option value="">请选择基金</option>
                                <!-- 基金选项将通过JavaScript动态生成 -->
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="selection-reason">请说明您的选择理由：</label>
                            <textarea id="selection-reason" placeholder="请从收益率、风险水平、投资策略等方面说明您的选择理由..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="risk-assessment">您如何评估该基金的风险水平？</label>
                            <textarea id="risk-assessment" placeholder="请评估该基金的风险水平及其适合的投资者类型..."></textarea>
                        </div>
                    </div>
                    
                    <div class="feedback" id="selection-feedback"></div>
                </div>
                
                <div class="navigation">
                    <button class="btn btn-secondary" id="back-to-analysis">
                        <i class="fas fa-arrow-left"></i> 上一步
                    </button>
                    <button class="btn" id="next-to-management">
                        下一步：组合管理 <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
            
            <!-- 步骤3：基金组合管理 -->
            <div class="panel step" id="step3">
                <div class="panel-title">
                    <i class="fas fa-sitemap"></i> 第三步：基金组合管理
                </div>
                
                <p>基于您的基金选择，构建一个多元化的投资组合，并调整各基金的配置比例。</p>
                
                <div class="portfolio-management">
                    <div class="portfolio-area">
                        <div class="portfolio-chart">
                            <div class="panel-title" style="margin-bottom: 15px;">
                                <i class="fas fa-chart-pie"></i> 组合配置
                            </div>
                            <div class="chart-container" id="portfolio-chart">
                                <!-- 饼图将通过JavaScript生成 -->
                            </div>
                        </div>
                        
                        <div class="portfolio-controls">
                            <div class="panel-title" style="margin-bottom: 15px;">
                                <i class="fas fa-sliders-h"></i> 组合调整
                            </div>
                            <div id="portfolio-items">
                                <!-- 投资组合项目将通过JavaScript动态生成 -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="portfolio-summary">
                        <div class="panel-title">
                            <i class="fas fa-chart-bar"></i> 组合分析
                        </div>
                        
                        <div class="summary-stats">
                            <div class="summary-stat">
                                <div class="stat-title">预期年化收益</div>
                                <div class="stat-value" id="expected-return">0%</div>
                            </div>
                            <div class="summary-stat">
                                <div class="stat-title">组合风险等级</div>
                                <div class="stat-value" id="risk-level">--</div>
                            </div>
                            <div class="summary-stat">
                                <div class="stat-title">最大回撤</div>
                                <div class="stat-value" id="max-drawdown">0%</div>
                            </div>
                            <div class="summary-stat">
                                <div class="stat-title">夏普比率</div>
                                <div class="stat-value" id="sharpe-ratio">0.0</div>
                            </div>
                        </div>
                        
                        <div class="feedback" id="portfolio-feedback"></div>
                    </div>
                </div>
                
                <div class="navigation">
                    <button class="btn btn-secondary" id="back-to-selection">
                        <i class="fas fa-arrow-left"></i> 上一步
                    </button>
                    <button class="btn" id="next-to-summary">
                        下一步：学习总结 <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
            
            <!-- 步骤4：学习总结 -->
            <div class="panel step" id="step4">
                <div class="panel-title">
                    <i class="fas fa-graduation-cap"></i> 第四步：学习总结
                </div>
                
                <div class="learning-advice">
                    <div class="completion-badge">恭喜完成基金选择挑战！</div>
                    
                    <div class="panel-title" style="margin-top: 25px;">
                        <i class="fas fa-graduation-cap"></i> 学习要点总结
                    </div>
                    
                    <ul class="advice-list">
                        <li class="advice-item">
                            <i class="fas fa-check-circle advice-icon"></i>
                            <span>基金选择需要综合考虑收益率、风险水平、投资策略和管理团队</span>
                        </li>
                        <li class="advice-item">
                            <i class="fas fa-check-circle advice-icon"></i>
                            <span>历史表现是评估基金的重要参考，但不能保证未来收益</span>
                        </li>
                        <li class="advice-item">
                            <i class="fas fa-check-circle advice-icon"></i>
                            <span>风险调整后收益指标（如夏普比率）比单纯收益率更能反映基金表现</span>
                        </li>
                        <li class="advice-item">
                            <i class="fas fa-check-circle advice-icon"></i>
                            <span>构建多元化投资组合可以有效分散风险，平衡收益与波动</span>
                        </li>
                        <li class="advice-item">
                            <i class="fas fa-check-circle advice-icon"></i>
                            <span>定期评估和调整投资组合是长期投资成功的关键</span>
                        </li>
                    </ul>
                    
                    <div class="panel-title" style="margin-top: 25px;">
                        <i class="fas fa-book"></i> 推荐学习资源
                    </div>
                    
                    <ul class="advice-list">
                        <li class="advice-item">
                            <i class="fas fa-book-open advice-icon"></i>
                            <span>《基金投资入门与实战技巧》- 王延明</span>
                        </li>
                        <li class="advice-item">
                            <i class="fas fa-book-open advice-icon"></i>
                            <span>《聪明的投资者》- 本杰明·格雷厄姆</span>
                        </li>
                        <li class="advice-item">
                            <i class="fas fa-book-open advice-icon"></i>
                            <span>《投资最重要的事》- 霍华德·马克斯</span>
                        </li>
                        <li class="advice-item">
                            <i class="fas fa-book-open advice-icon"></i>
                            <span>晨星网基金评级与分析</span>
                        </li>
                    </ul>
                </div>
                
                <div class="navigation">
                    <button class="btn btn-secondary" id="back-to-management">
                        <i class="fas fa-arrow-left"></i> 上一步
                    </button>
                    <button class="btn" id="restart-game">
                        <i class="fas fa-redo"></i> 重新开始
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 游戏状态管理
            const steps = document.querySelectorAll('.step');
            const stepDots = document.querySelectorAll('.step-dot');
            let currentStep = 1;
            
            // 基金数据
            const funds = {
                'fund1': {
                    name: '成长先锋股票基金',
                    type: '股票型',
                    description: '投资高成长性公司，追求长期资本增值',
                    returns: {
                        '1y': 15.2,
                        '3y': 12.8,
                        '5y': 11.5
                    },
                    risk: 8,
                    sharpe: 1.2,
                    maxDrawdown: 25,
                    volatility: 18,
                    manager: '张明',
                    inception: '2015-03-20'
                },
                'fund2': {
                    name: '稳健收益债券基金',
                    type: '债券型',
                    description: '投资高信用等级债券，追求稳定收益',
                    returns: {
                        '1y': 4.5,
                        '3y': 4.2,
                        '5y': 4.0
                    },
                    risk: 2,
                    sharpe: 1.8,
                    maxDrawdown: 5,
                    volatility: 3,
                    manager: '李华',
                    inception: '2010-08-15'
                },
                'fund3': {
                    name: '平衡配置混合基金',
                    type: '混合型',
                    description: '股票债券均衡配置，平衡风险与收益',
                    returns: {
                        '1y': 9.8,
                        '3y': 8.5,
                        '5y': 7.9
                    },
                    risk: 5,
                    sharpe: 1.5,
                    maxDrawdown: 15,
                    volatility: 10,
                    manager: '王强',
                    inception: '2012-11-05'
                },
                'fund4': {
                    name: '沪深300指数基金',
                    type: '指数型',
                    description: '紧密跟踪沪深300指数，低成本投资',
                    returns: {
                        '1y': 10.5,
                        '3y': 9.2,
                        '5y': 8.7
                    },
                    risk: 6,
                    sharpe: 1.3,
                    maxDrawdown: 20,
                    volatility: 15,
                    manager: '指数团队',
                    inception: '2013-06-18'
                },
                'fund5': {
                    name: '科技主题股票基金',
                    type: '股票型',
                    description: '专注科技行业投资，捕捉创新机会',
                    returns: {
                        '1y': 18.5,
                        '3y': 16.2,
                        '5y': 14.8
                    },
                    risk: 9,
                    sharpe: 1.1,
                    maxDrawdown: 30,
                    volatility: 22,
                    manager: '陈伟',
                    inception: '2016-09-12'
                },
                'fund6': {
                    name: '全球配置混合基金',
                    type: '混合型',
                    description: '全球资产配置，分散单一市场风险',
                    returns: {
                        '1y': 8.2,
                        '3y': 7.5,
                        '5y': 7.0
                    },
                    risk: 4,
                    sharpe: 1.6,
                    maxDrawdown: 12,
                    volatility: 8,
                    manager: '国际团队',
                    inception: '2014-02-28'
                }
            };
            
            // 当前选中的基金和时期
            let selectedFund = null;
            let selectedPeriod = '1y';
            let selectedFundForPortfolio = null;
            let portfolioAllocation = {};
            
            // 初始化基金卡片
            function initFundCards() {
                const fundCards = document.getElementById('fund-cards');
                fundCards.innerHTML = '';
                
                for (const fundId in funds) {
                    const fund = funds[fundId];
                    const card = document.createElement('div');
                    card.className = 'fund-card';
                    card.setAttribute('data-fund', fundId);
                    
                    // 确定风险等级
                    let riskLevel;
                    if (fund.risk <= 3) {
                        riskLevel = '低风险';
                    } else if (fund.risk <= 6) {
                        riskLevel = '中风险';
                    } else {
                        riskLevel = '高风险';
                    }
                    
                    card.innerHTML = `
                        <div class="fund-card-header">
                            <div class="fund-card-title">${fund.name}</div>
                            <div class="fund-card-badge">${fund.type}</div>
                        </div>
                        <div class="fund-description">${fund.description}</div>
                        <div class="fund-card-stats">
                            <div class="fund-card-stat">
                                <div class="fund-card-stat-value ${fund.returns[selectedPeriod] >= 0 ? 'positive' : 'negative'}">${fund.returns[selectedPeriod]}%</div>
                                <div class="fund-card-stat-label">${selectedPeriod === '1y' ? '1年' : selectedPeriod === '3y' ? '3年' : '5年'}收益</div>
                            </div>
                            <div class="fund-card-stat">
                                <div class="fund-card-stat-value">${riskLevel}</div>
                                <div class="fund-card-stat-label">风险等级</div>
                            </div>
                            <div class="fund-card-stat">
                                <div class="fund-card-stat-value">${fund.sharpe}</div>
                                <div class="fund-card-stat-label">夏普比率</div>
                            </div>
                            <div class="fund-card-stat">
                                <div class="fund-card-stat-value">${fund.manager}</div>
                                <div class="fund-card-stat-label">基金经理</div>
                            </div>
                        </div>
                    `;
                    
                    card.addEventListener('click', function() {
                        selectFund(fundId);
                    });
                    
                    fundCards.appendChild(card);
                }
                
                // 初始化基金选择下拉列表
                const fundSelection = document.getElementById('fund-selection');
                fundSelection.innerHTML = '<option value="">请选择基金</option>';
                
                for (const fundId in funds) {
                    const option = document.createElement('option');
                    option.value = fundId;
                    option.textContent = `${funds[fundId].name} (${funds[fundId].type})`;
                    fundSelection.appendChild(option);
                }
                
                fundSelection.addEventListener('change', function() {
                    selectedFundForPortfolio = this.value;
                });
            }
            
            // 选择基金
            function selectFund(fundId) {
                selectedFund = fundId;
                
                // 更新基金卡片选中状态
                document.querySelectorAll('.fund-card').forEach(card => {
                    card.classList.remove('selected');
                });
                document.querySelector(`.fund-card[data-fund="${fundId}"]`).classList.add('selected');
                
                // 更新基金详情
                updateFundDetails(fundId);
            }
            
            // 更新基金详情
            function updateFundDetails(fundId) {
                const fund = funds[fundId];
                
                document.getElementById('detail-name').textContent = fund.name;
                document.getElementById('detail-type').textContent = fund.type;
                
                // 更新基金统计数据
                const fundStats = document.getElementById('fund-stats');
                fundStats.innerHTML = '';
                
                const stats = [
                    { label: '基金经理', value: fund.manager },
                    { label: '成立日期', value: fund.inception },
                    { label: `${selectedPeriod === '1y' ? '1年' : selectedPeriod === '3y' ? '3年' : '5年'}收益率`, value: `${fund.returns[selectedPeriod]}%`, className: fund.returns[selectedPeriod] >= 0 ? 'positive' : 'negative' },
                    { label: '风险等级', value: fund.risk <= 3 ? '低' : fund.risk <= 6 ? '中' : '高' },
                    { label: '夏普比率', value: fund.sharpe },
                    { label: '最大回撤', value: `${fund.maxDrawdown}%` },
                    { label: '波动率', value: `${fund.volatility}%` },
                    { label: '适合投资者', value: fund.risk <= 3 ? '保守型' : fund.risk <= 6 ? '平衡型' : '激进型' }
                ];
                
                stats.forEach(stat => {
                    const statItem = document.createElement('div');
                    statItem.className = 'stat-item';
                    statItem.innerHTML = `
                        <span class="stat-label">${stat.label}</span>
                        <span class="stat-value ${stat.className || ''}">${stat.value}</span>
                    `;
                    fundStats.appendChild(statItem);
                });
                
                // 更新图表
                updatePerformanceChart();
            }
            
            // 更新性能对比图表
            function updatePerformanceChart() {
                const chartContainer = document.getElementById('performance-chart');
                chartContainer.innerHTML = '';
                
                // 创建SVG元素
                const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                svg.setAttribute("width", "100%");
                svg.setAttribute("height", "100%");
                chartContainer.appendChild(svg);
                
                const width = svg.clientWidth;
                const height = svg.clientHeight;
                const padding = 40;
                
                // 获取所有基金的收益率数据
                const returns = [];
                const fundNames = [];
                
                for (const fundId in funds) {
                    returns.push(funds[fundId].returns[selectedPeriod]);
                    fundNames.push(funds[fundId].name);
                }
                
                // 计算比例尺
                const maxReturn = Math.max(...returns);
                const minReturn = Math.min(...returns);
                const yRange = maxReturn - minReturn || 1;
                const yScale = (height - 2 * padding) / yRange;
                
                const barWidth = (width - 2 * padding) / returns.length;
                
                // 绘制柱状图
                returns.forEach((returnValue, index) => {
                    const barHeight = (returnValue - minReturn) * yScale;
                    const x = padding + index * barWidth + barWidth / 4;
                    const y = height - padding - barHeight;
                    
                    // 创建柱状
                    const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                    rect.setAttribute("x", x);
                    rect.setAttribute("y", y);
                    rect.setAttribute("width", barWidth / 2);
                    rect.setAttribute("height", barHeight);
                    rect.setAttribute("fill", returnValue === maxReturn ? "#4cc9f0" : (selectedFund && funds[selectedFund].returns[selectedPeriod] === returnValue ? "#ffd166" : "#4361ee"));
                    rect.setAttribute("rx", "2");
                    svg.appendChild(rect);
                    
                    // 添加数值标签
                    const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    text.setAttribute("x", x + barWidth / 4);
                    text.setAttribute("y", y - 5);
                    text.setAttribute("text-anchor", "middle");
                    text.setAttribute("fill", "white");
                    text.setAttribute("font-size", "10");
                    text.textContent = `${returnValue}%`;
                    svg.appendChild(text);
                    
                    // 添加基金名称标签
                    const nameText = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    nameText.setAttribute("x", x + barWidth / 4);
                    nameText.setAttribute("y", height - padding + 15);
                    nameText.setAttribute("text-anchor", "middle");
                    nameText.setAttribute("fill", "#a8c0ff");
                    nameText.setAttribute("font-size", "9");
                    nameText.textContent = fundNames[index].substring(0, 4) + '...';
                    svg.appendChild(nameText);
                });
                
                // 添加标题
                const title = document.createElementNS("http://www.w3.org/2000/svg", "text");
                title.setAttribute("x", width / 2);
                title.setAttribute("y", padding - 10);
                title.setAttribute("text-anchor", "middle");
                title.setAttribute("fill", "white");
                title.setAttribute("font-size", "12");
                title.setAttribute("font-weight", "bold");
                title.textContent = `${selectedPeriod === '1y' ? '1年' : selectedPeriod === '3y' ? '3年' : '5年'}收益率对比`;
                svg.appendChild(title);
            }
            
            // 更新性能对比表格
            function updatePerformanceTable() {
                const tableBody = document.getElementById('performance-table-body');
                tableBody.innerHTML = '';
                
                for (const fundId in funds) {
                    const fund = funds[fundId];
                    const row = document.createElement('tr');
                    
                    // 确定风险等级
                    let riskLevel;
                    if (fund.risk <= 3) {
                        riskLevel = '低';
                    } else if (fund.risk <= 6) {
                        riskLevel = '中';
                    } else {
                        riskLevel = '高';
                    }
                    
                    row.innerHTML = `
                        <td>${fund.name}</td>
                        <td>${fund.type}</td>
                        <td class="${fund.returns['1y'] >= 0 ? 'positive' : 'negative'}">${fund.returns['1y']}%</td>
                        <td class="${fund.returns['3y'] >= 0 ? 'positive' : 'negative'}">${fund.returns['3y']}%</td>
                        <td class="${fund.returns['5y'] >= 0 ? 'positive' : 'negative'}">${fund.returns['5y']}%</td>
                        <td>${riskLevel}</td>
                        <td>${fund.sharpe}</td>
                    `;
                    
                    tableBody.appendChild(row);
                }
            }
            
            // 初始化投资组合
            function initPortfolio() {
                const portfolioItems = document.getElementById('portfolio-items');
                portfolioItems.innerHTML = '';
                
                // 默认添加三个基金到投资组合
                const defaultFunds = ['fund1', 'fund3', 'fund6'];
                portfolioAllocation = {};
                
                defaultFunds.forEach(fundId => {
                    portfolioAllocation[fundId] = Math.floor(100 / defaultFunds.length);
                    addFundToPortfolio(fundId);
                });
                
                // 调整分配比例使其总和为100%
                adjustPortfolioAllocation();
                
                // 更新组合分析
                updatePortfolioAnalysis();
            }
            
            // 添加基金到投资组合
            function addFundToPortfolio(fundId) {
                const portfolioItems = document.getElementById('portfolio-items');
                
                const portfolioItem = document.createElement('div');
                portfolioItem.className = 'portfolio-item';
                portfolioItem.setAttribute('data-fund', fundId);
                
                portfolioItem.innerHTML = `
                    <div>
                        <div class="fund-name">${funds[fundId].name}</div>
                        <div class="fund-description">${funds[fundId].type}</div>
                    </div>
                    <div class="allocation-controls">
                        <input type="range" class="allocation-slider" min="0" max="100" value="${portfolioAllocation[fundId]}" data-fund="${fundId}">
                        <input type="number" class="allocation-input" min="0" max="100" value="${portfolioAllocation[fundId]}" data-fund="${fundId}">%
                        <button class="remove-btn" data-fund="${fundId}">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                
                portfolioItems.appendChild(portfolioItem);
                
                // 添加事件监听器
                portfolioItem.querySelector('.allocation-slider').addEventListener('input', function() {
                    const fundId = this.getAttribute('data-fund');
                    const value = parseInt(this.value);
                    portfolioAllocation[fundId] = value;
                    
                    // 同步输入框
                    portfolioItem.querySelector('.allocation-input').value = value;
                    
                    // 调整其他基金的分配比例
                    adjustPortfolioAllocation();
                    
                    // 更新组合分析
                    updatePortfolioAnalysis();
                });
                
                portfolioItem.querySelector('.allocation-input').addEventListener('input', function() {
                    const fundId = this.getAttribute('data-fund');
                    let value = parseInt(this.value) || 0;
                    
                    // 限制范围
                    if (value < 0) value = 0;
                    if (value > 100) value = 100;
                    
                    portfolioAllocation[fundId] = value;
                    
                    // 同步滑块
                    portfolioItem.querySelector('.allocation-slider').value = value;
                    
                    // 调整其他基金的分配比例
                    adjustPortfolioAllocation();
                    
                    // 更新组合分析
                    updatePortfolioAnalysis();
                });
                
                portfolioItem.querySelector('.remove-btn').addEventListener('click', function() {
                    const fundId = this.getAttribute('data-fund');
                    removeFundFromPortfolio(fundId);
                });
            }
            
            // 从投资组合中移除基金
            function removeFundFromPortfolio(fundId) {
                // 从投资组合中移除
                delete portfolioAllocation[fundId];
                
                // 移除DOM元素
                document.querySelector(`.portfolio-item[data-fund="${fundId}"]`).remove();
                
                // 调整剩余基金的分配比例
                adjustPortfolioAllocation();
                
                // 更新组合分析
                updatePortfolioAnalysis();
            }
            
            // 调整投资组合分配比例
            function adjustPortfolioAllocation() {
                const fundIds = Object.keys(portfolioAllocation);
                if (fundIds.length === 0) return;
                
                let totalAllocation = 0;
                for (const fundId in portfolioAllocation) {
                    totalAllocation += portfolioAllocation[fundId];
                }
                
                // 如果总分配比例不为100%，调整比例
                if (totalAllocation !== 100) {
                    const adjustment = 100 - totalAllocation;
                    const adjustmentPerFund = adjustment / fundIds.length;
                    
                    for (const fundId of fundIds) {
                        portfolioAllocation[fundId] += adjustmentPerFund;
                        portfolioAllocation[fundId] = Math.round(portfolioAllocation[fundId]);
                        
                        // 更新UI
                        const slider = document.querySelector(`.allocation-slider[data-fund="${fundId}"]`);
                        const input = document.querySelector(`.allocation-input[data-fund="${fundId}"]`);
                        
                        if (slider) slider.value = portfolioAllocation[fundId];
                        if (input) input.value = portfolioAllocation[fundId];
                    }
                    
                    // 递归调整，直到总和为100%
                    adjustPortfolioAllocation();
                }
            }
            
            // 更新组合分析
            function updatePortfolioAnalysis() {
                const fundIds = Object.keys(portfolioAllocation);
                
                if (fundIds.length === 0) {
                    // 如果没有基金，重置分析
                    document.getElementById('expected-return').textContent = '0%';
                    document.getElementById('risk-level').textContent = '--';
                    document.getElementById('max-drawdown').textContent = '0%';
                    document.getElementById('sharpe-ratio').textContent = '0.0';
                    return;
                }
                
                // 计算加权预期收益
                let weightedReturn = 0;
                for (const fundId in portfolioAllocation) {
                    const allocation = portfolioAllocation[fundId] / 100;
                    weightedReturn += funds[fundId].returns['3y'] * allocation;
                }
                document.getElementById('expected-return').textContent = `${weightedReturn.toFixed(1)}%`;
                
                // 计算加权风险
                let weightedRisk = 0;
                for (const fundId in portfolioAllocation) {
                    const allocation = portfolioAllocation[fundId] / 100;
                    weightedRisk += funds[fundId].risk * allocation;
                }
                
                // 确定风险等级
                let riskLevel;
                if (weightedRisk <= 3) {
                    riskLevel = '低';
                } else if (weightedRisk <= 6) {
                    riskLevel = '中';
                } else {
                    riskLevel = '高';
                }
                document.getElementById('risk-level').textContent = riskLevel;
                
                // 计算最大回撤（简化计算）
                let maxDrawdown = 0;
                for (const fundId in portfolioAllocation) {
                    const allocation = portfolioAllocation[fundId] / 100;
                    maxDrawdown += funds[fundId].maxDrawdown * allocation;
                }
                document.getElementById('max-drawdown').textContent = `${maxDrawdown.toFixed(1)}%`;
                
                // 计算夏普比率（简化计算，假设无风险利率为2%）
                const sharpeRatio = (weightedReturn - 2) / weightedRisk;
                document.getElementById('sharpe-ratio').textContent = sharpeRatio.toFixed(2);
                
                // 更新投资组合反馈
                const portfolioFeedback = document.getElementById('portfolio-feedback');
                if (fundIds.length < 2) {
                    portfolioFeedback.textContent = '建议增加更多基金以实现更好的风险分散';
                    portfolioFeedback.className = 'feedback incorrect';
                } else if (weightedRisk > 7) {
                    portfolioFeedback.textContent = '您的投资组合风险较高，适合激进型投资者';
                    portfolioFeedback.className = 'feedback incorrect';
                } else if (weightedRisk < 3) {
                    portfolioFeedback.textContent = '您的投资组合风险较低，适合保守型投资者';
                    portfolioFeedback.className = 'feedback correct';
                } else {
                    portfolioFeedback.textContent = '您的投资组合风险适中，适合平衡型投资者';
                    portfolioFeedback.className = 'feedback correct';
                }
                
                // 更新饼图
                updatePortfolioChart();
            }
            
            // 更新投资组合饼图
            function updatePortfolioChart() {
                const chartContainer = document.getElementById('portfolio-chart');
                chartContainer.innerHTML = '';
                
                // 创建SVG元素
                const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                svg.setAttribute("width", "100%");
                svg.setAttribute("height", "100%");
                chartContainer.appendChild(svg);
                
                const width = svg.clientWidth;
                const height = svg.clientHeight;
                const radius = Math.min(width, height) / 2 - 20;
                const centerX = width / 2;
                const centerY = height / 2;
                
                // 颜色方案
                const colors = ['#4cc9f0', '#4361ee', '#3a0ca3', '#7209b7', '#f72585', '#ff9e00'];
                
                // 计算饼图扇区
                let startAngle = 0;
                let colorIndex = 0;
                
                for (const fundId in portfolioAllocation) {
                    const allocation = portfolioAllocation[fundId];
                    const angle = (allocation / 100) * 2 * Math.PI;
                    const endAngle = startAngle + angle;
                    
                    // 计算扇区路径
                    const x1 = centerX + radius * Math.cos(startAngle);
                    const y1 = centerY + radius * Math.sin(startAngle);
                    const x2 = centerX + radius * Math.cos(endAngle);
                    const y2 = centerY + radius * Math.sin(endAngle);
                    
                    const largeArcFlag = angle > Math.PI ? 1 : 0;
                    
                    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    path.setAttribute("d", `M ${centerX} ${centerY} L ${x1} ${y1} A ${radius} ${radius} 0 ${largeArcFlag} 1 ${x2} ${y2} Z`);
                    path.setAttribute("fill", colors[colorIndex % colors.length]);
                    path.setAttribute("stroke", "white");
                    path.setAttribute("stroke-width", "1");
                    svg.appendChild(path);
                    
                    // 添加标签
                    const labelAngle = startAngle + angle / 2;
                    const labelRadius = radius * 0.7;
                    const labelX = centerX + labelRadius * Math.cos(labelAngle);
                    const labelY = centerY + labelRadius * Math.sin(labelAngle);
                    
                    const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    text.setAttribute("x", labelX);
                    text.setAttribute("y", labelY);
                    text.setAttribute("text-anchor", "middle");
                    text.setAttribute("fill", "white");
                    text.setAttribute("font-size", "10");
                    text.textContent = `${allocation}%`;
                    svg.appendChild(text);
                    
                    startAngle = endAngle;
                    colorIndex++;
                }
            }
            
            // 时间周期切换
            document.querySelectorAll('.time-period').forEach(period => {
                period.addEventListener('click', function() {
                    // 更新活动状态
                    document.querySelectorAll('.time-period').forEach(p => {
                        p.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // 更新选中的时间周期
                    selectedPeriod = this.getAttribute('data-period');
                    
                    // 更新基金卡片
                    initFundCards();
                    
                    // 如果已选择基金，更新详情
                    if (selectedFund) {
                        updateFundDetails(selectedFund);
                    }
                });
            });
            
            // 步骤导航
            document.getElementById('next-to-selection').addEventListener('click', function() {
                navigateToStep(2);
            });
            
            document.getElementById('back-to-analysis').addEventListener('click', function() {
                navigateToStep(1);
            });
            
            document.getElementById('next-to-management').addEventListener('click', function() {
                const fundSelection = document.getElementById('fund-selection').value;
                const selectionReason = document.getElementById('selection-reason').value.trim();
                const riskAssessment = document.getElementById('risk-assessment').value.trim();
                
                if (!fundSelection) {
                    const selectionFeedback = document.getElementById('selection-feedback');
                    selectionFeedback.textContent = '请选择一支基金';
                    selectionFeedback.className = 'feedback incorrect';
                    return;
                }
                
                if (!selectionReason) {
                    const selectionFeedback = document.getElementById('selection-feedback');
                    selectionFeedback.textContent = '请说明您的选择理由';
                    selectionFeedback.className = 'feedback incorrect';
                    return;
                }
                
                if (!riskAssessment) {
                    const selectionFeedback = document.getElementById('selection-feedback');
                    selectionFeedback.textContent = '请评估该基金的风险水平';
                    selectionFeedback.className = 'feedback incorrect';
                    return;
                }
                
                selectedFundForPortfolio = fundSelection;
                navigateToStep(3);
            });
            
            document.getElementById('back-to-selection').addEventListener('click', function() {
                navigateToStep(2);
            });
            
            document.getElementById('next-to-summary').addEventListener('click', function() {
                navigateToStep(4);
            });
            
            document.getElementById('back-to-management').addEventListener('click', function() {
                navigateToStep(3);
            });
            
            document.getElementById('restart-game').addEventListener('click', function() {
                // 重置所有状态
                selectedFund = null;
                selectedPeriod = '1y';
                selectedFundForPortfolio = null;
                portfolioAllocation = {};
                
                // 重置表单
                document.getElementById('fund-selection').value = '';
                document.getElementById('selection-reason').value = '';
                document.getElementById('risk-assessment').value = '';
                
                // 重新初始化
                initFundCards();
                updatePerformanceTable();
                initPortfolio();
                
                // 回到第一步
                navigateToStep(1);
            });
            
            // 导航到指定步骤
            function navigateToStep(stepNumber) {
                currentStep = stepNumber;
                
                // 更新步骤显示
                steps.forEach(step => step.classList.remove('active'));
                document.getElementById(`step${stepNumber}`).classList.add('active');
                
                // 更新步骤指示器
                stepDots.forEach(dot => dot.classList.remove('active'));
                document.querySelector(`.step-dot[data-step="${stepNumber}"]`).classList.add('active');
                
                // 如果是第三步，初始化投资组合
                if (stepNumber === 3) {
                    initPortfolio();
                }
            }
            
            // 初始化
            initFundCards();
            updatePerformanceTable();
            updatePerformanceChart();
        });
    </script>
</body>
</html>